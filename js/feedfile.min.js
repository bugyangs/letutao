$(function() {
    $("div[rel=small]").live("click",
    function() {
		
        var c = $(this);
		
        "1" == c.data("hasbig") ? (c.parent().hide(), c.parent().siblings().show()) : $.ajax({
            url: GUANGER.path + "index.php?app=share&ac=do&le=getbaobeidetail",
            type: "post",
            dataType: "json",
            data: {
                goodsid: c.data("proid")
				
            },
            success: function(a) {
				
				
                if (100 == a.code) {
					
                    var i = a.baobei.goods_id,
					
                    g = a.url,
                    d = a.baobei.name,
                    j = GUANGER.path+a.baobei.img,
                    f = a.baobei.comment,
                    f = f ? 40 < f.length ? f.substring(0, 40) + "...": f: "",
					buy = a.baobei.taoke_url
					buy = buy.length >0? a.baobei.taoke_url:a.baobei.url,
                    e = "";
                    var h = "";
                    if (a.baobei.tags && 0 < a.baobei.tags.length) for (b = 0; b < a.baobei.tags.length; b++) h += "<span>" + a.baobei.tags[b]['tag_name'] + "</span>";
                    b = a.baobei.count_worth	;
                    a = '<div class="baobei-feeds-detail clearfix">' + ('<div class="baobei-pic" rel="big"><a href="javascript:;"><img src="' + j + '" alt="' + d + '" /></a><span>\uffe5' + a.baobei.price + '</span></div><div class="baobei-text"><h4><a target="_blank" href="' + g + '">' + d + '</a></h4><div class="baobei-info"><p>' + f + "</p>" + e + '</div><div class="clearfix mt15"><div class="stat-box"><a href="'+ buy +'" target="_blank"><b>直接购买</b></a><span class="mr5 ml5">|</span>有<span id="fcnum_'+i+'">' + a.baobei.count_comment + '</span>个人\u8bc4\u8bba<span class="mr5 ml5">|</span>有<span id="flikenum_'+i+'">' + a.baobei.count_like + '</span>人喜欢</div></div></div><a target="_blank" href="' + g + '" class="baobei-link"></a>') + "</div>";
                    c.parent().after(a);
                    c.parent().hide();
                    c.data("hasbig", "1")
                }else if(101 == a.code){
					
					
					alert('数据加载失败！');
					
					
				}
            }
        })
    });
    $("div[rel=big]").live("click",
    function() {
        $(this).parent().hide();
        $(this).parent().siblings().show()
    })
	
	$("a[rel=del_feed]").live("click",function(){
				if($.guang.dialog.isLogin()){
					var curGoodsItem = $(this).closest(".section");
					var feedid = $(this).attr("data-feedid");
					
					if(confirm('您确定要删除此动态吗？')){
				
					$.ajax({
				   url: GUANGER.path+"index.php?app=share&ac=do&le=del_feed",
				   type : "post",
				   dataType: "json",
				   data: {
					   feedid : feedid
				   },
				   success: function(data){
					   var $json = data;
					   switch($json.code){
					   case(100):
						   curGoodsItem.hide(500);
						  break;
					   case(101):
						   alert($json.msg);
					   	break;
					   }  
				   }
			});
					
				}
				}
	});
	
});




$(function() {
    var c = 0,
    f = $(".side #J_FeedsNews"),
    b = $(".side #J_FeedsNews li"),
    a = function(b, c, d) {
        c > b ? (f.scrollTop(b + 1), setTimeout(function() {
            a(b + 1, c, d)
        },
        20)) : d && d()
    },
    d = function() {
        var h = f.scrollTop(),
        e = h + 47;
        c++;
        c >= b.length ? a(h, e,
        function() {
            f.scrollTop(0);
            c = 0
        }) : a(h, e);
        setTimeout(d, 5E3)
    };
    3 < b.length && (f.append(b.slice(0, 3).clone()), setTimeout(d, 5E3))
});


$(function() {
    var c = function() {
        $.ajax({
            url: GUANGER.path + "index.php?app=share&ac=do&le=feeds_count",
            type: "post",
            dataType: "json",
            success: function(b) {
				y = parseInt($("#J_FeedsNotes span").html())+b.feedsMessageNum;
                100 == b.code && 0 !== b.feedsMessageNum && ($("#J_FeedsNotes").length ? $("#J_FeedsNotes").html("\u6709 <span>" +y+ "</span> \u6761\u65b0\u52a8\u6001\uff0c\u70b9\u51fb\u5237\u65b0") : $(".feeds-menu").after("<a id='J_FeedsNotes' href='javascript:window.location.reload();'>\u6709 <span>" + b.feedsMessageNum + "</span> \u6761\u65b0\u52a8\u6001\uff0c\u70b9\u51fb\u5237\u65b0</a>"))
            }
        });
        setTimeout(c, 3E4)
    };
    setTimeout(c, 3E4);
    var f = window.location.href; - 1 != f.indexOf("ex=1") && 0 != $("#J_OnlyComment").length && ($("#J_OnlyComment")[0].checked = !0);
    $("#J_OnlyComment").click(function() {
        window.location.href = this.checked && f.indexOf("ex=1") == -1 ? f + (f.indexOf("?") != -1 ? "&ex=1": "?ex=1") : f.replace(/[?&]ex=1/, "")
    })
});


