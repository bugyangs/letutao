(function(a){a.guang.wordCount={conf:{okClk:function(){},errorClk:function(){}},init:function(e,b,c,f){function d(){b.text(g-parseInt(i()))}var g=c,k=f||15,l=-1!=f,h=e[0],i=function(){var b=a.trim(e.val());return a.guang.util.getStrLength(b)};d();e.bind("keypress",function(a){i()>=g&&"0"!=a.charCode&&a.preventDefault()});e.bind("keyup",function(){d();if(i()>=g)if(l){h.value=h.value.substr(0,2*g+100);var b=setInterval(function(){i()<=g?(b=clearInterval(b),d()):(h.value=h.value.substring(0,h.value.length-
1),a.guang.wordCount.conf.errorClk(h.value.length))},k)}else e[0].value=h.value.substr(0,g)}).focus(function(){d()})}};a.guang.tipForOper={conf:{html:""},init:function(){if(a("#J_TipForOper")[0])a("#J_TipForOper").data("overlay").load();else{var e;e='<div id="J_TipForOper" class="g-dialog tip-for-oper"><div class="dialog-content"><div class="bd clearfix">'+a.guang.tipForOper.conf.html;a("body").append(e+"</div></div></div>");a("#J_TipForOper").overlay({top:"center",mask:{color:"#000",loadSpeed:200,
opacity:0.3},closeOnClick:!1,load:!0})}a("#J_TipForOper .closeD").click(function(){a("#J_TipForOper").overlay().close()})}};a.guang.bindSnsShare={init:function(e){var b={sina:"ss-sina",tec_weibo:"ss-tencent",qzone:"ss-qzone"};a.ajax({url:GUANGER.path+"/account/getUserSns.html",type:"post",dataType:"json",success:function(c){if(100==c.code){var f="",c=c.userSns,d;for(d in c)b[d]&&(f+='<li class="share-switch '+b[d]+"-btnclick-"+c[d]+' btnclick" data-status="'+c[d]+'" data-snsid="'+d+'" data-webname="'+
b[d]+'"></li>');e.html(f);a(".btnclick").bind("click",function(){var b=a(this),c=b.attr("data-webname")+"-btnclick-on",d=b.attr("data-webname")+"-btnclick-off";"on"==b.data("status")?b.removeClass(c).addClass(d).data("status","off"):b.removeClass(d).addClass(c).data("status","on")})}}})}};a.guang.inviteFellowJudge={isValiEmail:function(e){a.get(GUANGER.path+"/jianding/invite",function(a){switch(a.code){case 100:var c="",c=a.isValidateEmail?'\u4eca\u5929\u8fd8\u53ef\u53d1\u9001<em id="J_RemainPhoneNum">'+
a.remainSmsCount+"</em>\u6761\uff08"+a.t_smscount+"\u6761/\u5929\uff09":'\u4eca\u5929\u8fd8\u53ef\u53d1\u9001<em id="J_RemainPhoneNum">'+a.remainSmsCount+"</em>\u6761\uff08"+a.q_smscount+'\u6761/\u5929\uff0c<a href="'+GUANGER.path+'/account/basic" target="_target">\u5b8c\u5584Email\u5e10\u53f7\u53ef\u53d1'+a.t_smscount+"\u6761/\u5929</a>\uff09";e.html(c);break;case 101:alert("\u7528\u6237\u5269\u4f59\u77ed\u4fe1\u6761\u6570\u83b7\u53d6\u5931\u8d25\u4e86\uff0c\u5237\u65b0\u9875\u9762\u518d\u8bd5\u8bd5\u770b\u3002")}})},
init:function(e){if(!a.guang.dialog.isLogin())return!1;if(a("#J_DialogInviteFellowJudge")[0])a("#J_DialogInviteFellowJudge").data("overlay").load();else{var b;b='<div id="J_DialogInviteFellowJudge" class="g-dialog invite-judge-dialog" style="width:450px"><div class="dialog-content"><div class="hd"><h3>\u9080\u8bf7\u597d\u53cb\u6765\u9274\u5b9a</h3></div><div class="bd clearfix"><div class="judge-by-sns"><div class="fr"><span><em id="J_CountCur">20</em>/<em id="J_CountLimit">100</em></span></div><div class="fl"><div class="share-sns-title clearfix"><span class="choice-judge-style fl"><label><input type="checkbox" value="" checked="checked" id="J_JudgeBySnsChk"/>\u65b9\u5f0f\u4e00</label></span><h3>\u9080\u8bf7\u793e\u533a\u597d\u53cb\u6765\u9274\u5b9a\uff1a</h3><ul id="J_BindSnsShare" class="bind-sns"></ul>'+
('<span class="fl"><a href="'+GUANGER.path+'/account/sns" target="_blank">\u8bbe\u7f6e</a></span>');a("body").append(b+'</div></div><textarea class="b-textarea" id="J_CountContent">\u5728\u901b\u4e0a\u770b\u5230\u8fd9\u4e2a\u5b9d\u8d1d\uff0c\u9ebb\u70e6\u5e2e\u6211\u770b\u770b\u503c\u4e0d\u503c</textarea><span class="tip error"></span></div><div class="judge-by-phone clearfix"><span class="choice-judge-style fl"><label><input type="checkbox" value="" id="J_JudgeByPhoneChk"/>\u65b9\u5f0f\u4e8c</label></span><h3>\u901a\u8fc7\u624b\u673a\u77ed\u4fe1\u53d1\u9001\u597d\u53cb\uff08\u514d\u8d39\uff09</h3><div style="clear:both;padding-bottom:10px"></div><div class="phone-info clearfix"><div class="phone-info-who"><label>\u4f60\u662f\u8c01\uff1a</label><input type="text" class="base-input" maxLength="8" placeholder="\u8ba9\u670b\u53cb\u77e5\u9053\u4f60\u662f\u8c01"/><span class="tip error"></span></div><div class="phone-info-nums"><label>\u53d1\u9001\u5230\uff1a</label><ul id="J_PhoneNumsUl"><li><a class="add-phone-num-btn inlineblock" id="J_AddPhoneNumBtn"> + \u586b\u5199\u5bf9\u65b9\u624b\u673a\u53f7\u7801</a><span class="tip error"></span><p id="J_RemainNumInfo"></p></li></ul></div></div></div><div class="clearfix oper-btn"><input type="submit" class="bbl-btn pub" id="J_InviteJudgeSubmit" value="\u786e\u5b9a"><span class="tip error"></span></div><div><a class="close" href="javascript:;"></a></div></div>');
var c=a("#J_BindSnsShare");a.guang.bindSnsShare.init(c);a.guang.inviteFellowJudge.isValiEmail(a("#J_RemainNumInfo"));var f=a("#J_DialogInviteFellowJudge");f.overlay({top:"center",fixed:!1,mask:{color:"#000",loadSpeed:200,opacity:0.3},closeOnClick:!1,load:!0});var d=a("#J_CountLimit").text(),g=a("#J_CountCur"),k=a("#J_CountContent");a.guang.wordCount.conf.errorClk=function(a){g.text("trimming\u2026  "+(d-a))};a.guang.wordCount.init(k,g,d,20);b=a("#J_InviteJudgeSubmit");var l=a("#J_JudgeBySnsChk"),
h=a("#J_JudgeByPhoneChk"),i=f.find(".phone-info-who:first");f.find(".phone-info-nums:first");var j=a("#J_PhoneNumsUl");f.find(".oper-btn:first .tip:first");var p=a("#J_RemainNumInfo"),m=a("#J_AddPhoneNumBtn");h.die().live("click",function(){var b=f.find(".phone-info:first");!1==a(this)[0].checked?b.slideUp():b.slideDown()});m.die().live("click",function(){var b=a(this),c=j.find("input:last"),d=/^(13[0-9]|15[012356789]|18[0236789]|14[57])[0-9]{8}$/.test(a.trim(c.val())),e=a("#J_RemainPhoneNum"),f=
parseInt(e.html());c[0]&&11!=c.val().length?c.next(".tip").html("\u624b\u673a\u53f7\u4e3a11\u4f4d\u6570\u5b57").show():c[0]&&!d?c.next(".tip").html("\u975e\u6709\u6548\u624b\u673a\u53f7\u7801").show():0<f?(b.parent("li").before('<li><input type="text" class="base-input" placeholder="" /><span class="tip error"></span><a class="J_DeletePhoneBtn inlineblock">\u5220\u9664</a></li>'),e.html(f-1),0<f-1?e.css("color","#505050"):e.css("color","#d02200")):b.next(".tip").html("\u77ed\u4fe1\u6761\u6570\u6ee1\u4e86\uff01").show();
j.find("input:last").focus()});j.find(".J_DeletePhoneBtn").die().live("click",function(){var b=p.find("em:first"),c=parseInt(b.html());a(this).closest("li").remove();b.html(c+1).css("color","#505050");m.next(".tip").hide()});j.find("input").die().live("blur",function(){var b=a.trim(a(this).val()),c=/^(13[0-9]|15[012356789]|18[0236789]|14[57])[0-9]{8}$/.test(b),d=a(this).next(".tip");""!=b&&11!=b.length?d.html("\u624b\u673a\u53f7\u4e3a11\u4f4d\u6570\u5b57").show():""!=b&&!c?d.html("\u975e\u6709\u6548\u624b\u673a\u53f7\u7801").show():
d.hide()});var n="true";b.die().live("click",function(){var b=a(this),d={productId:e.data("proid"),snsSiteIds:"",content4Sns:"",userName:"",mobiles:[]},f=function(){var b=0<c.find("li").length&&0<c.find('li[class*="-btnclick-on"]').length,e=a.trim(k.val());if(b&&""!=e){var f=[];c.find('li[class*="-btnclick-on"]').each(function(){f.push(a(this).attr("data-snsid"))});d.snsSiteIds=f.join(",");d.content4Sns=e;return!0}""==e?k.next(".tip").html("\u5206\u4eab\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff01").show():
k.next(".tip").hide();b||(jQuery.guang.tip.conf.tipClass="tipmodal tipmodal-error2",jQuery.guang.tip.show(c,"\u81f3\u5c11\u8bbe\u7f6e\u4e00\u4e2a\u5206\u4eab\u7684\u793e\u533a"));return!1},g=function(){var b=i.find(".tip:first"),c=a.trim(i.find("input:first").val());if(""==c)return b.html("\u8fd9\u91cc\u8bb0\u5f97\u8981\u5199\u54e6\uff01").show(),!1;if(10<a.guang.util.getStrLength(c))return b.html("\u4e0d\u80fd\u8d85\u8fc710\u4e2a\u6c49\u5b57").show(),!1;if(0==j.find("input").length)return b.hide(),
m.next(".tip").html("\u8bf7\u586b\u5199\u597d\u53cb\u7684\u624b\u673a\u53f7\u7801").show(),!1;b.hide();m.next(".tip").hide();var e=[];j.find("input").each(function(){var b=a.trim(a(this).val());""!=b&&/^(13[0-9]|15[012356789]|18[0236789]|14[57])[0-9]{8}$/.test(b)?e.push(b):a(this).next(".tip").html("\u624b\u673a\u53f7\u4e3a11\u4f4d\u6570\u5b57").show()});return 0<e.length&&e.length==j.find("input").length?(d.userName=c,d.mobiles=e,!0):!1},o=function(){if("false"==n)return!1;n="false";var c=b.next(".tip");
a.ajax({type:"POST",url:GUANGER.path+"/jianding/doInvite.html",data:{data:JSON.stringify(d)},success:function(d){switch(d.code){case 100:d=a("#J_PhoneNumsUl");1<d.find("li").length&&d.find("li").slice(0,-1).remove();d='<p class="success-text"><span class="correct">\u9080\u8bf7\u9274\u5b9a\u6210\u529f\uff01</span></p>'+('<p class="clearfix"><a class="bbl-btn goCheck" href="'+GUANGER.path+'/jianding/my/">\u67e5\u770b\u6211\u7684\u6c42\u9274\u5b9a</a>');a.guang.tipForOper.conf.html=d+'<a class="bgr-btn closeD ml10" href="javascript:;">\u5173\u95ed</a></p>';
a.guang.tipForOper.init();break;case 101:b.val("\u91cd\u65b0\u63d0\u4ea4").addClass("J_ClickDisabled"),c.html("\u9080\u8bf7\u5931\u8d25\uff0c\u91cd\u65b0\u63d0\u4ea4\u770b\u770b\uff01").show()}n="true"},error:function(){c.html('<a onclick="window.location.reload()" style="cursor:pointer;">\u5237\u65b0</a>\u9875\u9762\uff0c\u518d\u63d0\u4ea4\u8bd5\u8bd5\uff01');n="true"}})};!0==l[0].checked&&!0==h[0].checked?(b.next(".tip").hide(),f()&&g()&&o()):!0==l[0].checked?(b.next(".tip").hide(),f()&&o()):!0==
h[0].checked?(b.next(".tip").hide(),g()&&o()):b.next(".tip").html("\u81f3\u5c11\u9009\u62e9\u4e00\u79cd\u65b9\u5f0f").show()})}}}})(jQuery);
