function scrollTo(o) {
    $("html, body").animate({
        scrollTop: o
    },
    120)
}
$(function() {
    var o, p, u;
    function C(a) {
        $.ajax({
            url: GUANGER.path + ("all" == o ? "/baobei/listIdentifyComments.html": "/baobei/listIdentifyCommentsWithType.html"),
            type: "post",
            dataType: "json",
            data: {
                id: commentParameter.productId,
                userType: o,
                pageNo: p,
                pageSize: 10
            },
            success: function(b) {
                var e = b.worth_page ? b.worth_page.items ? b.worth_page.items.length: 0 : 0,
                d = b.unworth_page ? b.unworth_page.items ? b.unworth_page.items.length: 0 : 0,
                c = "",
                f = "";
                if (0 < e) for (var g = 0; g < e; g++) {
                    var l = GUANGER.path + "/u/" + b.worth_page.items[g].userId,
                    h = b.worth_page.items[g].userNick,
                    v = b.worth_page.items[g].commentContent,
                    q = b.worth_page.items[g].displayTime,
                    i = "",
                    j = '<a href="' + l + '" target="_blank">' + h + "</a>",
                    i = "",
                    k = b.worth_page.items[g].displayType;
                    b.worth_page.items[g].level && "daren" == b.worth_page.items[g].level && (j = '<a class="g-daren" href="' + l + '" target="_blank"><em>' + h + '</em><i class="i-daren">\u8fbe\u4eba</i></a>');
                    i = b.worth_page.items[g].userPhoto ? b.worth_page.items[g].userPhoto: "http://static.www.letushuo.com/images/user/photo/avatar-50.png";
                    "11" == b.worth_page.items[g].sourceType ? (h = "\u624b\u673a\u7528\u6237(" + h + ")", j = "<span>" + h + "</span>", i = '<div class="fl mr10"><img src="' + i + '" width="50" height="50" alt="' + h + '" /></div>') : "10" == b.worth_page.items[g].sourceType ? i = '<a class="fl mr10" href="' + l + '" target="_blank"><img src="' + i + '" width="50" height="50" alt="' + h + '" /></a>': (j = "<span>" + h + "</span>", q = "", i = '<div class="fl mr10"><img src="' + i + '" width="50" height="50" alt="' + h + '" /></div>');
                    c += '<li class="clearfix">';
                    c += i;
                    c += '<div class="pk-txt fr">';
                    c += '<p class="mb5">' + j + '<span class="gc">' + k + "</span></p>";
                    c += '<p class="mb5">' + v + '</p><p><span class="gc">' + q + "</span></p>";
                    c += "</div>";
                    c += "</li>"
                }
                if (0 < d) for (g = 0; g < d; g++) l = GUANGER.path + "/u/" + b.unworth_page.items[g].userId,
                h = b.unworth_page.items[g].userNick,
                v = b.unworth_page.items[g].commentContent,
                q = b.unworth_page.items[g].displayTime,
                j = '<a href="' + l + '" target="_blank">' + h + "</a>",
                k = b.unworth_page.items[g].displayType,
                b.unworth_page.items[g].level && "daren" == b.unworth_page.items[g].level && (j = '<a class="g-daren" href="' + l + '" target="_blank"><em>' + h + '</em><i class="i-daren">\u8fbe\u4eba</i></a>'),
                i = b.unworth_page.items[g].userPhoto ? b.unworth_page.items[g].userPhoto: "http://static.www.letushuo.com/images/user/photo/avatar-50.png",
                "11" == b.unworth_page.items[g].sourceType ? (h = "\u624b\u673a\u7528\u6237(" + h + ")", j = "<span>" + h + "</span>", i = '<div class="fr ml10"><img src="' + i + '" width="50" height="50" alt="' + h + '" /></div>') : "10" == b.unworth_page.items[g].sourceType ? i = '<a class="fr ml10" href="' + l + '" target="_blank"><img src="' + i + '" width="50" height="50" alt="' + h + '" /></a>': (j = "<span>" + h + "</span>", q = "", i = '<div class="fr ml10"><img src="' + i + '" width="50" height="50" alt="' + h + '" /></div>'),
                f += '<li class="clearfix">',
                f += i,
                f += '<div class="pk-txt fl">',
                f += '<p class="mb5">' + j + '<span class="gc">' + k + "</span></p>",
                f += '<p class="mb5">' + v + '</p><p><span class="gc">' + q + "</span></p>",
                f += "</div>",
                f += "</li>";
                $(".pk-worth ul").html(c);
                $(".pk-unworth ul").html(f);
                if (a) $("#J_PKWorthNum").text(b.worthCount),
                $("#J_PKUnworthNum").text(b.unworthCount),
                $("#J_PKWorthCmtNum").text(b.worth_page.totalCount),
                $("#J_PKUnworthCmtNum").text(b.unworth_page.totalCount),
                u = b.identify_totalNum,
                p = 1,
                J.pagination(u, {
                    num_edge_entries: 1,
                    num_display_entries: 4,
                    callback: K,
                    callback_run: !1,
                    items_per_page: 10,
                    current_page: p - 1,
                    isJump: !1
                });
                scrollTo(r)
            }
        })
    }
    function K(a) {
        p = a + 1;
        C(0);
        scrollTo(r);
        return ! 1
    }
    function L(a, b) {
        if ("" != b && 2 <= $.guang.util.getStrLength(b)) {
            if (1E3 < $.guang.util.getStrLength(b)) return $.guang.tip.conf.tipClass = "tipmodal tipmodal-general",
            $.guang.tip.show(a, ">_< \u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc71000\u4e2a\u6c49\u5b57\uff01"),
            !1
        } else return $.guang.tip.conf.tipClass = "tipmodal tipmodal-general",
        $.guang.tip.show(a, ">_< \u4f60\u7684\u8bc4\u8bba\u592a\u77ed\u5566\uff0c\u518d\u591a\u8bf4\u51e0\u53e5\u5427\uff01"),
        !1;
        return ! 0
    }
    var m = $("#J_ShowResult"),
    w = commentParameter.productId;
    $(".thumb-list li").mouseover(function() {
        if (!$(this).hasClass("cur")) {
            var a = $(this).find("img").attr("data-src");
            $(".pic-box img").attr("src", a);
            $(".thumb-list li.cur").removeClass("cur");
            $(this).addClass("cur")
        }
    });
    $(".scrollable").scrollable({
        circular: !1,
        prev: ".thumb-nav-prev",
        next: ".thumb-nav-next",
        disabledClass: "disable"
    });
    $(".shops-slider").scrollable({
        vertical: !0,
        circular: !1,
        touch: !1,
        disabledClass: "disable"
    }).navigator(".shop-navi");
    $(".product-tab a").click(function() {
        var a = $(this),
        b = a.parent("li"),
        a = a.data("index");
        if (b.hasClass("active")) return ! 1;
        $(".product-tab li.active").removeClass("active");
        b.addClass("active");
        switch (a) {
        case 0:
            $(".pic-list, #product-discuss, #product-like").show();
            break;
        case 1:
            $("#product-discuss, #product-like").show();
            $(".pic-list").hide();
            break;
        case 2:
            $("#product-like").show(),
            $(".pic-list, #product-discuss").hide()
        }
    });
    var x = $("#J_LikeCount"),
    t = {};
    $(".pic-box").hover(function() {
        $(".btn-like").show()
    },
    function() {
        $(".btn-like").hide()
    });
    $(".btn-like").click(function() {
        var a = $(this);
        Do("guang_comment",
        function() {
            if ("disable" != a.data("enable")) {
                a.data("enable", "disable");
                setTimeout(function() {
                    a.data("enable", "enable")
                },
                1E3);
                var b = a.attr("data-type"),
                e = null;
                $.guang.judgement.repeatIdentityClk = function(b) {
                    a.data("enable", "enable");
                    $("#cmtDialog")[0] && (clearTimeout(e), $("#cmtDialog").remove());
                    var c;
                    c = '<div id="cmtDialog" class="c-dialog" style="width:180px;"><p class="title clearfix"><a class="cmtclose fr" href="javascript:;">x</a>>_<\u559c\u6b22\u8fc7\u4e86~</p>' + ('<a class="sbl-btn speakmore comment-tag" data-type="0" data-proid="' + w + '">\u518d\u8bf4\u4e24\u53e5</a>');
                    $("body").append(c + "</div>");
                    b = $.guang.util.getPosition(b).topMid();
                    c = $("#cmtDialog").outerWidth();
                    var f = $("#cmtDialog").outerHeight();
                    $("#cmtDialog").css({
                        left: b.x - c / 2 + "px",
                        top: b.y - f - 12 + "px"
                    }).fadeIn();
                    e = setTimeout(function() {
                        $("#cmtDialog").fadeOut()
                    },
                    3E3);
                    $(".comment-tag").unbind();
                    $(".comment-tag").bind("click",
                    function() {
                        if (0 == $(this).data("type")) t.like = 1;
                        $("#product-discuss").show();
                        $("#J_CommentTxa").focus();
                        scrollTo($("#product-discuss").offset().top - 55)
                    })
                };
                $.guang.judgement.identityCallback = function(b) {
                    a.data("enable", "enable");
                    if ("" == GUANGER.userId) {
                        var c = $.cookie("productFavor");
                        if (null != c && "" != c) c = c.split(",").length,
                        $(".unlogin-like-text .count").text(c),
                        $(".unlogin-like").show();
                        return ! 1
                    }
                    if ($("#J_LikeDialog")[0]) $("#J_LikeDialog").data("overlay").load();
                    else {
                        c = "" + ('<div id="J_LikeDialog" class="like-dialog"><div class="content"><div class="title">\u559c\u6b22\u4e86~</div><p>\u628a\u5b83\u52a0\u5165\u4e3b\u9898\uff0c\u65b9\u4fbf\u4e4b\u540e\u518d\u627e\u7740\u5b83~</p><div class="topic-box"><ul class="topic-list"></ul></div><div class="create-box"><a class="btn-plus" href="javascript:;"></a><input type="text" name="new-topic" id="J_NewTopic" placeholder="\u521b\u5efa\u65b0\u4e3b\u9898\uff08\u56de\u8f66\u76f4\u63a5\u521b\u5efa\uff09" /><a class="btn-enter" href="javascript:;"></a></div><div class="say-box"><input type="text" name="say-text" id="J_SaySth" placeholder="\u8bf4\u4e24\u53e5" /></div><div class="clearfix pt15" id="comment-form"><input type="button" class="bbl-btn done" value="\u5b8c\u6210" /><input type="button" class="bgr-btn cancel ml10" value="\u53d6\u6d88" /><div class="share-comment"><span class="gc">\u540c\u6b65\u5206\u4eab\uff1a</span><ul id="J_UserSns"></ul><span><a href="' + GUANGER.path + '/account/sns" target="_blank">\u8bbe\u7f6e</a></span></div></div><a class="close" href="javascript:;"></a></div></div>');
                        $("body").append(c);
                        $("#J_LikeDialog").overlay({
                            top: "center",
                            mask: {
                                color: "#000",
                                loadSpeed: 200,
                                opacity: 0.3
                            },
                            closeOnClick: !1,
                            load: !0
                        });
                        $.getJSON(GUANGER.path + "index.php?app=share&ac=do&le=getzhutiJSON&math=" + Math.floor(new Date / 10),
                        function(a) {
                            if (100 == a.code) {
                                var b = [];
                                $.map(a.userTopics,
                                function(a) {
                                    b.push('<li class="ofh"><label for="' + a.themeid + '"><input type="checkbox" id="' + a.themeid + '" /> ' + a.title + "</label></li>")
                                });
                                $("#J_LikeDialog .topic-list").html(b.join(""))
                            } else 110 == a.code ? $("#J_LikeDialog .topic-list").html('<li class="no-topic">\u4f60\u8fd8\u6ca1\u521b\u5efa\u8fc7\u4e3b\u9898</li>') : $("#J_LikeDialog .topic-list").html("<li>\u83b7\u53d6\u4e3b\u9898\u5217\u8868\u5931\u8d25</li>")
                        });
                        var f = {
                            sina: "ss-sina",
                            tec_weibo: "ss-tencent",
                            qzone: "ss-qzone"
                        },
                        e = $("#J_LikeDialog #J_UserSns");
                        $.ajax({
                            url: GUANGER.path + "/account/getUserSns.html",
                            type: "post",
                            dataType: "json",
                            success: function(a) {
                                if (100 == a.code) {
                                    var b = "",
                                    a = a.userSns,
                                    d;
                                    for (d in a) f[d] && (b += '<li class="share-switch ' + f[d] + "-btnclick-" + a[d] + ' btnclick" data-status="' + a[d] + '" data-snsid="' + d + '" data-webname="' + f[d] + '"></li>');
                                    e.append(b);
                                    $("#J_LikeDialog .btnclick").unbind().bind("click",
                                    function() {
                                        var a = $(this),
                                        b = a.attr("data-webname") + "-btnclick-on",
                                        d = a.attr("data-webname") + "-btnclick-off";
                                        "on" == a.data("status") ? a.removeClass(b).addClass(d).data("status", "off") : a.removeClass(d).addClass(b).data("status", "on")
                                    })
                                }
                            }
                        });
                        c = parseInt(x.data("val")) + 1;
                        x.text("\u559c\u6b22(" + c + ")");
                        x.data("val", c);
                        $("#J_LikeDialog .btn-plus").click(function(a) {
                            a.preventDefault();
                            $("#J_NewTopic").focus()
                        });
                        $("#J_NewTopic").keydown(function(a) {
                            var b = $(this);
                            "13" == a.keyCode && $("#J_LikeDialog .btn-enter").trigger("click");
                            "" != $.trim(b.val()) ? $("#J_LikeDialog .btn-enter").show() : $("#J_LikeDialog .btn-enter").hide()
                        });
                        $("#J_LikeDialog .btn-enter").click(function(a) {
                            a.preventDefault();
                            var b = $("#J_NewTopic"),
                            d = $.trim(b.val());
                            "" == d ? ($.guang.tip.conf.tipClass = "tipmodal tipmodal-error", $.guang.tip.show(b, "\u4e3b\u9898\u540d\u5b57\u4e0d\u80fd\u4e3a\u7a7a"), $("#J_NewTopic").focus()) : $.ajax({
                                url: GUANGER.path + "index.php?app=share&ac=do&le=addToTopic",
                                type: "post",
                                dataType: "json",
                                data: {
                                    topicName: d,
                                    gallerys: ""
                                },
                                success: function(a) {
                                    100 == a.code ? (b.val(""), $("#J_LikeDialog .topic-list .no-topic")[0] && $("#J_LikeDialog .topic-list .no-topic").remove(), $("#J_LikeDialog .topic-list").prepend('<li class="ofh"><label for="' + a.topicId + '"><input type="checkbox" id="' + a.topicId + '" checked /> ' + d + "</label></li>")) : ($.guang.tip.conf.tipClass = "tipmodal tipmodal-error", $.guang.tip.show(b, "\u521b\u5efa\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5~"))
                                }
                            })
                        });
                        $("#J_LikeDialog .done").click(function() {
                            var a = $(this),
                            c = {};
                            if (!a.data("clicked")) {
                                var f = [];
                                $("#J_LikeDialog .topic-list input:checked").each(function() {
                                    var a = $(this);
                                    f.push(a.attr("id"))
                                });
                                c.topicIds = f.join(",");
                                c.productId = b.data("proid");
                                c.userComment = $.trim($("#J_LikeDialog #J_SaySth").val());
                                var e = $("#J_LikeDialog #J_UserSns li").length;
                                if (0 < e) for (var g = 0; g < e; g++) if ("on" == $("#J_LikeDialog #J_UserSns li").eq(g).data("status")) {
                                    var j = $("#J_LikeDialog #J_UserSns li").eq(g).data("snsid");
                                    c.snsSiteIds = c.snsSiteIds ? c.snsSiteIds + ("," + j) : j
                                }
                                var e = commentParameter.snsProName,
                                g = commentParameter.snsProUrl,
                                j = c.userComment,
                                k = 135 - $.guang.util.getStrLength("\u8bc4\u8bba\u4e86\u300a$\u300b:" + e + g);
                                c.commentContent4Sns = $.guang.util.getStrLength(j) > k ? "\u8bc4\u8bba\u4e86\u300a$\u300b:".replace("$", e) + $.guang.util.substring4ChAndEn(j, k) + "..." + g: "\u8bc4\u8bba\u4e86\u300a$\u300b:".replace("$", e) + j + "\u3002" + g;
                                if (0 == f.length && "" == j) return $.guang.tip.conf.tipClass = "tipmodal tipmodal-error",
                                $.guang.tip.show(a, "\u8bf7\u52a0\u5165\u4e3b\u9898\u6216\u8005\u8bf4\u4e24\u53e5~"),
                                !1;
                                $.ajax({
                                    url: GUANGER.path + "index.php?app=share&ac=do&le=addToTopic",
                                    type: "post",
                                    dataType: "json",
                                    data: c,
                                    beforeSend: function() {
                                        a.data("clicked", !0)
                                    },
                                    success: function(b) {
                                        a.data("clicked", !1);
                                        100 == b.code ? ($.guang.tip.conf.tipClass = "tipmodal tipmodal-ok", $.guang.tip.show(a, "\u63d0\u4ea4\u6210\u529f~"), $("#J_LikeDialog").data("overlay").close()) : ($.guang.tip.conf.tipClass = "tipmodal tipmodal-error", $.guang.tip.show(a, "\u63d0\u4ea4\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5~"))
                                    }
                                })
                            }
                        });
                        $("#J_LikeDialog .cancel").click(function() {
                            $("#J_LikeDialog").data("overlay").close()
                        })
                    }
                };
                $.guang.judgement.identityOper(a, w, b)
            }
        })
    });
    var y = function(a) {
        var b = $(".appraisal"),
        e = commentParameter.commentSum + 1,
        d = commentParameter.worthCount,
        c = commentParameter.unworthCount;
        "1" == a ? (d += 1, commentParameter.worthCount = d, $("#J_IdentifyNum").text(d + c), $("#J_PKWorthNum").text(d), $("#J_PKWorthCmtNum").text(parseInt($("#J_PKWorthCmtNum").text()) + 1), $("#J_PKWorth").empty().remove(), $("#J_PKUnworth").empty().remove(), $(".identify-list").append('<div id="J_PKWorth">\u4f60\u8ba4\u4e3a\u503c\u5f97</div>')) : (c += 1, commentParameter.unworthCount = c, $("#J_IdentifyNum").text(d + c), $("#J_PKUnworthNum").text(c), $("#J_PKUnworthCmtNum").text(parseInt($("#J_PKUnworthCmtNum").text()) + 1), $("#J_PKWorth").empty().remove(), $("#J_PKUnworth").empty().remove(), $(".identify-list").append('<div id="J_PKUnworth">\u4f60\u8ba4\u4e3a\u4e0d\u503c\u5f97</div>'));
        "1" == a ? b.html('<span class="gc">\u6211\u8ba4\u4e3a\u5b83\u503c\u5f97</span>') : "2" == a && b.html('<span class="gc">\u6211\u8ba4\u4e3a\u5b83\u4e0d\u503c\u5f97</span>');
        commentParameter.commentSum = e;
        $("#J_CmtCount, #J_CmtNum").text(e)
    },
    z = function(a, b, e) {
        var d = "";
        "0" == b && (d += "\u559c\u6b22", e && (y("1" == e ? "1": "2"), d += "1" == e ? "\uff0c\u8ba4\u4e3a\u503c\u5f97": "\uff0c\u8ba4\u4e3a\u4e0d\u503c\u5f97"), "1" == commentParameter.bought && (d += "\uff0c\u4e70\u8fc7"), $("#J_LikerNum").text(parseInt($("#J_LikerNum").text()) + 1));
        if ("1" == b || "2" == b) d += "1" == b ? "\u8ba4\u4e3a\u503c\u5f97": "\u8ba4\u4e3a\u4e0d\u503c\u5f97",
        "1" == commentParameter.bought && (d += "\uff0c\u4e70\u8fc7"),
        y(b),
        D(b, a.commentContent, d);
        "3" == b && (e && (y("1" == e ? "1": "2"), d += "1" == e ? "\u8ba4\u4e3a\u503c\u5f97": "\u8ba4\u4e3a\u4e0d\u503c\u5f97", D(e, a.commentContent, d)), "1" == commentParameter.bought && (d += 0 < d.length ? "\uff0c\u4e70\u8fc7": "\u4e70\u8fc7", $(".bought-ck").html('<span class="gc">\u6211\u4e70\u8fc7</span>')));
        d = 0 < d.length ? "\uff08" + d + "\uff09": "";
        a = E({
            commentContent: a.commentContent,
            id: a.commentId,
            displayTime: "\u521a\u521a",
            displayType: d,
            sourceType: "Guang.com",
            userNick: GUANGER.nick,
            level: GUANGER.level,
            userPhoto: GUANGER.userPhoto,
            userId: GUANGER.userId,
            replyCount: 0,
            usefulCount: 0,
            hasVotedUseful: !1
        });
        0 == m.find(".cmt").length && m.html("");
        switch (commentParameter.curCommentType) {
        case "all":
            m.prepend(a);
            break;
        case "like":
            "0" == b && m.prepend(a);
            break;
        case "bought":
            "1" == commentParameter.bought && m.prepend(a)
        }
    };
    if ($(".buy-info")[0]) {
        var s = $(".buy-info"),
        n = null;
        $("#J_BuyBox").hover(function() {
            null != n && clearTimeout(n);
            s.show()
        },
        function() {
            n = setTimeout(function() {
                s.hide()
            },
            100)
        });
        s.hover(function() {
            null != n && clearTimeout(n);
            s.show()
        },
        function() {
            n = setTimeout(function() {
                s.hide()
            },
            100)
        });
        $(".shops li").hover(function() {
            $(this).addClass("bg-blue");
            var a = $(this),
            b = a.find(".shop-tip").html();
            $(".tooltip").html(b);
            a = $.guang.util.getPosition(a).leftTop();
            $(".tooltip").css({
                left: a.x - 210 + "px",
                top: a.y
            }).show()
        },
        function() {
            $(this).removeClass("bg-blue");
            $(".tooltip").hide()
        })
    }
    $("#J_HowToBuy").hover(function() {
        $(".discount-process").show()
    },
    function() {
        $(".discount-process").hide()
    });
    $(".J_JiuCuo").find("a:first").click(function() {
        $(this).parent().html("<span>\u5df2\u53cd\u9988</span>");
        $.get(GUANGER.path + "/jiucuo/" + w,
        function() {}).success(function() {})
    });
    var A = "on",
    H = function(a, b, e) {
        if ("off" == A) return ! 1;
        $.ajax({
            url: GUANGER.path + "/baobei/listComments.html",
            type: "post",
            dataType: "json",
            data: {
                id: b,
                commentType: a,
                pageNo: e,
                pageSize: 10,
                sortAll: commentParameter.sortAll,
                sortLike: commentParameter.sortLike,
                sortBuy: commentParameter.sortBuy
            },
            beforeSend: function() {
                A = "off"
            },
            success: function(b) {
                A = "on";
                var c = "";
                switch (b.code) {
                case 100:
                    if (0 < b.page.totalCount) {
                        for (var f = 0; f < b.page.items.length; f++) c += E(b.page.items[f]);
                        m.html(c)
                    } else m.html("\u6682\u65f6\u8fd8\u6ca1\u6709\u8bc4\u8bba\u54e6\uff01");
                    F[a].commentSum = b.page.totalCount;
                    F[a].current_page = e - 1;
                    commentParameter.current_page = e - 1;
                    G();
                    break;
                case 101:
                    $.guang.tip.conf.tipClass = "tipmodal tipmodal-error",
                    $.guang.tip.show($this, b.msg)
                }
            }
        })
    },
    B = "off",
    M = function(a) {
        if ("off" == B) return B = "on",
        "off";
        H(commentParameter.curCommentType, commentParameter.productId, a + 1);
        scrollTo(r);
        return ! 1
    },
    N = $("#J_Pagination1"),
    G = function() {
        B = "off";
        var a = commentParameter.commentSum;
        "like" == commentParameter.curCommentType ? a = parseInt($("#J_LikerNum").text()) : "bought" == commentParameter.curCommentType && (a = parseInt($("#J_BoughtNum").text()));
        N.pagination(a, {
            num_edge_entries: 1,
            num_display_entries: 4,
            callback: M,
            items_per_page: 10,
            current_page: commentParameter.current_page
        })
    };
    G();
    var E = function(a) {
        var b = a.displayType ? a.displayType: "",
        e = a.displayTime ? a.displayTime: "",
        d = "";
        a.userId || "10" == a.sourceType ? d = "Guang.com": (d = "\u4e92\u8054\u7f51", e = "");
        "11" == a.sourceType && (d = '<a href="http://m.www.letushuo.com/" target="_blank">\u901b <strong>\u00b7</strong> \u624b\u673a\u5ba2\u6237\u7aef</a>');
        var c = a.userId ? a.userId: "",
        f = a.userNick ? a.userNick: "";
        "11" == a.sourceType && (f = "\u624b\u673a\u7528\u6237(" + f + ")");
        var g = "",
        g = a.userPhoto ? a.userPhoto: "http://static.www.letushuo.com/images/user/photo/avatar-50.png",
        l = "",
        h = "";
        a.userId ? (l = '<a class="fl" href="http://www.letushuo.com/u/' + c + '" target="_blank">' + f + "</a>", h = '<a href="http://www.letushuo.com/u/' + c + '"><img src="' + g + '" alt="' + f + '" /></a>', a.level && "daren" == a.level && (l = '<a class="fl g-daren" href="http://www.letushuo.com/u/' + c + '" target="_blank"><em>' + f + '</em><i class="i-daren">\u8fbe\u4eba</i></a>')) : (l = '<span class="fl">' + f + "</span>", h = '<img src="' + g + '" alt="' + f + '" />');
        c = "";
        0 < parseInt(a.replyCount) && (c = "(" + a.replyCount + ")");
        f = "";
        g = "usefulBtn";
        0 < parseInt(a.usefulCount) && (f = "(" + a.usefulCount + ")");
        a.hasVotedUseful && (g = "usefulBtn disableLnk");
        return '<div class="cmt clearfix cmt-noworth"  data-cmtid="' + a.id + '"><div class="user-pic">' + h + '</div><div class="cmt-doc bg-gray"><div class="cmt-info clearfix">' + l + '<span class="fl gc">' + b + '</span><span class="fr gc">\u6765\u81ea ' + d + '</span><span class="fr gc mr10">' + e + '</span></div><p class="cmt-content clearfix"><span>' + a.commentContent + '</span><a class="J_CmtReplyBtn btn">\u56de\u590d<em class="J_ReplyCount" data-count="' + a.replyCount + '">' + c + '</em></a><a class="' + g + '">\u6709\u7528<em class="usefulCount" data-count="' + a.usefulCount + '">' + f + "</em></a></p></div></div>"
    },
    D = function(a, b, e) {
        var d = GUANGER.nick,
        c = GUANGER.userPhoto,
        f = GUANGER.path + "/u/" + GUANGER.userId,
        g = "",
        e = 0 < e.length ? "\uff08" + e + "\uff09": "";
        "1" == a ? $(".pk-worth ul").prepend(g + '<li class="clearfix">' + ('<a class="fl mr10" href="' + f + '" target="_blank">') + ('<img src="' + c + '" width="50" height="50" alt="' + d + '" /></a>') + '<div class="pk-txt fr">' + ('<p class="mb5"><a href="' + f + '" target="_blank">' + d + '</a><span class="gc">' + e + "</span></p>") + ('<p class="mb5">' + b + '</p><p><span class="gc">\u521a\u521a</span></p>') + "</div></li>") : "2" == a && $(".pk-unworth ul").prepend(g + '<li class="clearfix">' + ('<a class="fr ml10" href="' + f + '" target="_blank">') + ('<img src="' + c + '" width="50" height="50" alt="' + d + '" /></a>') + '<div class="pk-txt fl">' + ('<p class="mb5"><a href="' + f + '" target="_blank">' + d + '</a><span class="gc">' + e + "</span></p>") + ('<p class="mb5">' + b + '</p><p><span class="gc">\u521a\u521a</span></p>') + "</div></li>")
    },
    F = {
        all: {
            commentList: "",
            commentSum: commentParameter.commentSum,
            current_page: 0
        },
        like: {
            commentList: "",
            commentSum: 0,
            current_page: 0
        },
        bought: {
            commentList: "",
            commentSum: 0,
            current_page: 0
        }
    },
    r = $("#product-discuss").offset().top - 40;
    $("#J_CmtNav a").click(function() {
        if ($(this).hasClass("current")) return ! 1;
        $("#J_CmtNav a.current").removeClass("current");
        $(this).addClass("current");
        var a = $(this).data("type");
        "identify" == a ? ($(".comment").hide(), $(".identify").show(), C(1), $(".sort").hide()) : (commentParameter.curCommentType = a, H(commentParameter.curCommentType, commentParameter.productId, 1), $(".identify").hide(), $(".comment").show(), scrollTo(r), $(".sort").hide(), $(".sort-" + a).show())
    });
    u = 0;
    p = 1;
    o = "all";
    var J = $("#J_Pagination2"),
    k = $("#J_InviteFellowJudge");
    k[0] && k.click(function(a) {
        a.preventDefault();
        var b = $(this);
        Do("invite_identify",
        function() {
            $.guang.inviteFellowJudge.init(b)
        })
    });
    k = window.location.hash.substring(1);
    if ( - 1 != k.indexOf("cmt")) if ( - 1 != k.indexOf("cmt=") && $(".cmt[data-cmtid=" + k.split("=")[1] + "]")[0]) {
        var I = $(".cmt[data-cmtid=" + k.split("=")[1] + "]").first();
        scrollTo(I.offset().top - 45);
        I.find(".J_CmtReplyBtn:first").trigger("click")
    } else scrollTo(r); ("s" == commentParameter.identifyType || "m" == commentParameter.identifyType) && $("#J_CmtJdBtn").trigger("click");
    $(".appraisal .jd-radio").live("click",
    function() {
        var a = $(this);
        a.hasClass("worth-radioclick-on") ? a.removeClass("worth-radioclick-on").addClass("worth-radioclick-off") : ($(".worth-radioclick-on").removeClass("worth-radioclick-on").addClass("worth-radioclick-off"), a.removeClass("worth-radioclick-off").addClass("worth-radioclick-on"))
    });
    $("#J_UserSns1 li").bind("click",
    function() {
        var a = $(this),
        b = a.attr("data-webname") + "-btnclick-on",
        e = a.attr("data-webname") + "-btnclick-off";
        "on" == a.data("status") ? a.removeClass(b).addClass(e).data("status", "off") : a.removeClass(e).addClass(b).data("status", "on")
    });
    $("#J_CommentTxa").focus(function() {
        $.guang.dialog.isLogin() && ($("#J_CmtHiddenForm").show(), $(this).height(50))
    });
    $(".detail-usedTags-row li").click(function() {
        var a = $("#J_CommentTagsDetail").val().replace(/^[\uff0c\,]+/, "").replace(/[\uff0c\,]+$/, ""),
        b = "," + a + ",",
        e = $(this);
        if (e.hasClass("selected")) {
            a = "," + e.text() + ",";
            for (b = b.replace(a, ","); 0 <= b.indexOf(a);) b = b.replace(a, ",");
            b = b.replace(/^[\uff0c\,]+/, "").replace(/[\uff0c\,]+$/, "");
            $("#J_CommentTagsDetail").val(b);
            e.removeClass("selected")
        } else b = a.length ? a + "," + e.text() : e.text(),
        64 >= $.guang.util.getStrLength($.guang.util.htmlToTxt(b)) ? ($("#J_CommentTagsDetail").val(b), e.addClass("selected")) : ($.guang.tip.conf.tipClass = "tipmodal tipmodal-general", $.guang.tip.show(e, ">_< \u6807\u7b7e\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc764\u4e2a\u6c49\u5b57\uff01"))
    });
    $("#J_CommentTagsDetail").keyup(function() {
        var a = this.value;
        if (64 >= $.guang.util.getStrLength($.guang.util.htmlToTxt(a))) {
            $(this);
            for (a = a.replace(/\uff0c|\s+/g, ","); 0 <= a.indexOf(",,");) a = a.replace(",,", ",");
            for (var b = a.split(","), e = 0, d = !1; e < b.length; e++) {
                var c = b[e];
                14 < $.guang.util.htmlToTxt(c).length && (d = !0, b[e] = $.guang.util.substring4ChAndEn(c, 14))
            }
            d && (a = b.join(","));
            if (a != this.value) this.value = a;
            $(".detail-usedTags-row li").each(function() {
                var b = $(this);
                0 <= ("," + a + ",").indexOf("," + b.text() + ",") ? b.hasClass("selected") || b.addClass("selected") : b.hasClass("selected") && b.removeClass("selected")
            })
        } else this.value = $.guang.util.substring4ChAndEn(a, 64)
    });
    $("#J_HiddenForm").click(function() {
        $("#J_CmtHiddenForm").hide();
        $("#J_CommentTxa").height(26)
    });
    $("#J_PublishBtn").click(function() {
        if ($.guang.dialog.isLogin()) {
            var a = $(this),
            b = $.trim($("#J_CommentTxa").val()),
            e = !1;
            if (L(a, b) && !e) {
                var d = {
                    productId: commentParameter.productId,
                    sid: commentParameter.sId,
                    commentContent: b,
                    tagNames: $("#J_CommentTagsDetail").val(),
                    snsSiteIds: "",
                    productImgUrl: commentParameter.snsImg,
                    commentContent4Sns: "",
                    identify: "",
                    bought: ""
                };
                if (0 < $("#J_UserSns1 li").length) for (var c = 0; c < $("#J_UserSns1 li").length; c++) if ("on" == $("#J_UserSns1 li").eq(c).data("status")) {
                    var f = $("#J_UserSns1 li").eq(c).data("snsid");
                    d.snsSiteIds += 0 < d.snsSiteIds.length ? "," + f: f
                }
                var c = commentParameter.snsProName,
                f = commentParameter.snsProUrl,
                g = 135 - $.guang.util.getStrLength("\u8bc4\u8bba\u4e86\u300a$\u300b:" + c + f);
                d.commentContent4Sns = $.guang.util.getStrLength(b) > g ? "\u8bc4\u8bba\u4e86\u300a$\u300b:".replace("$", c) + $.guang.util.substring4ChAndEn(b, g) + "..." + f: "\u8bc4\u8bba\u4e86\u300a$\u300b:".replace("$", c) + b + "\u3002" + f;
                if (0 < $(".appraisal .worth-radioclick-on").length) d.identify = parseInt($(".worth-radioclick-on").eq(0).attr("data-type"), 10);
                if ($("#J_Bought1")[0] && $("#J_Bought1")[0].checked) d.bought = 1;
                $.extend(d, t);
                $.ajax({
                    url: GUANGER.path + "/baobei/commentMore",
                    type: "post",
                    dataType: "json",
                    data: d,
                    beforeSend: function() {
                        e = !0
                    },
                    success: function(b) {
                        e = !1;
                        switch (b.code) {
                        case 100:
                            $("#J_CommentTxa").val("").height(26);
                            $("#J_CmtHiddenForm").show();
                            $("#J_CommentTagsDetail").val("");
                            $(".detail-usedTags-row li").each(function() {
                                $(this).removeClass("selected")
                            });
                            if (1 == d.bought) commentParameter.bought = "1",
                            $("#J_BoughtNum").text(parseInt($("#J_BoughtNum").text()) + 1);
                            var c = "" + d.identify + "",
                            f = t.like ? "0": "3";
                            if ("" == c) z(b, f),
                            commentParameter.commentSum += 1,
                            $("#J_CmtCount, #J_CmtNum").text(commentParameter.commentSum);
                            else if ("1" == c) z(b, f, "1"),
                            commentParameter.identify = "1";
                            else if ("0" == c) z(b, f, "2"),
                            commentParameter.identify = "2";
                            t = {};
                            break;
                        case 101:
                            $.guang.tip.conf.tipClass = "tipmodal tipmodal-error";
                            $.guang.tip.show(a, b.msg);
                            break;
                        case 441:
                            alert("\u4eb2,\u64cd\u4f5c\u8fc7\u5feb\u4e86\u54e6,\u4f11\u606f\u7247\u523b\uff01");
                            break;
                        case 444:
                            alert("\u4f60\u5df2\u88ab\u7981\u6b62\u767b\u5f55\uff01");
                            window.location.href = "http://www.letushuo.com/logout";
                            break;
                        case 440:
                            alert("\u4f60\u5df2\u88ab\u7981\u8a00\uff01")
                        }
                    }
                })
            }
        }
    });
    "true" == commentParameter.showReply || "true" == commentParameter.showComment ? (k = $(".cmt:first").offset().top - 40, scrollTo(k)) : -1 == k.indexOf("cmt") && scrollTo(80);
    $(".ilike-topic").click(function(a) {
        a.preventDefault();
        var b = this;
        Do("topic_add_goods",
        function() {
            $.guang.addToTopic.init($(b))
        })
    });
    "like" == commentParameter.tab ? $("#J_CmtLoveBtn").trigger("click") : "bought" == commentParameter.tab && $("#J_CmtBoughtBtn").trigger("click");
    $(".usefulBtn").live("click",
    function() {
        if ($.guang.dialog.isLogin()) {
            var a = $(this),
            b = a.find(".usefulCount"),
            e = a.parents(".cmt").data("cmtid");
            a.hasClass("disableLnk") || $.ajax({
                url: GUANGER.path + "/baobei/useful?productCommentId=" + e,
                type: "post",
                dataType: "json",
                beforeSend: function() {
                    a.addClass("disableLnk")
                },
                success: function(d) {
                    100 == d.code ? (d = parseInt(b.data("count")) + 1, b.html("(" + d + ")")) : a.removeClass("disableLnk")
                }
            })
        }
    });
    $(".J_GetDiscountBtn").click(function() {
        $.guang.productDiscount.init($(this))
    });
    $("#J_ProShops").find("li[rel=priority]").prependTo($("#J_ProShops"));
    $("#J_PKWorth,#J_PKUnworth").bind("click",
    function() {
        $("#J_CommentTxa").focus();
        scrollTo($("#product-discuss").offset().top - 55)
    });
    $(".buy-info")[0] && $(".buy-btn").click(function() {
        var a = $(".buy-info li:eq(0)").parent("a").attr("href");
        window.open(a)
    });
    $(".goods-wall")[0] && Do("goods_flow",
    function() {
        $.guang.goods.conf.columns = 3;
        $.guang.goods.conf.justFlow = !0;
        $.guang.goods.init();
        $(".ilike-m").live("click",
        function() {
            var a = $(this);
            $.guang.dialog.like_say(this,
            function() {
                var b = a.parent().parent().find(".like-count:first");
                b.text(parseInt(b.text()) + 1)
            })
        })
    })
});