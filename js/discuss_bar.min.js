jQuery(function(){$(".col-right").each(function(){var b=$(this),d=b.find(".pic-list"),a=b.find(".sourceHtml").html(),c=b.find(".image-jsonStr").html(),g=b.find(".video-jsonStr").html(),f=""==c?{}:eval("("+c+")"),j=""==g?{}:eval("("+g+")"),g=/\[\u56fe\u7247(\d+)\]|\[\u89c6\u9891(\d+)\]|\[\u5b9d\u8d1d(\d+)\]/g,c=a.replace(g,"").replace(/\[\/?(\w+)\]/g,""),a=a.match(g),c=$.guang.util.ellipse(c,65);b.find(".topic-text").html(c);a=null==a?[]:a;3<a.length&&(a=a.slice(0,3));0<a.length&&$.each(a,function(b,
c){var a=c.substr(3,c.length-4);-1!=c.indexOf("\u56fe\u7247")?f[a]&&d.append('<li data-type="image" data-big="'+f[a].bigPic+'"><img src="'+f[a].smallPic+'" alt="" /></li>'):-1!=c.indexOf("\u5b9d\u8d1d")?f[a]&&d.append('<li data-type="goods" data-id="'+a+'"><img src="'+f[a].smallPic+'" alt="" /></li>'):-1!=c.indexOf("\u89c6\u9891")&&j[a]&&d.append('<li data-type="video" data-url="'+j[a]+'"><img src="http://static.www.letushuo.com/images/ui/video.png" alt="" /><a class="video-play" href="javascript:;"></a></li>')})});
$(".topic-preview li").live("click",function(){var b=$(this),d=b.data("type"),a=b.parents(".topic-preview");switch(d){case "image":a.hide();b=b.data("big");a.after('<div class="media-box media-image"><div class="media-oper"><a class="retract" href="javascript:;">\u6536\u8d77</a><span class="vline5">|</span><a class="show-big" href="'+b+'" target="_blank">\u67e5\u770b\u5927\u56fe</a></div><div class="topic-image"><img src="'+b+'" alt="" /></div></div>');break;case "video":a.hide(),b='<div class="media-box media-video"><div class="media-oper"><a class="retract" href="javascript:;">\u6536\u8d77</a></div><div class="topic-video"><embed id="" width="580" height="470" allowscriptaccess="never" pluginspage="http://get.adobe.com/cn/flashplayer/" flashvars="playMovie=true&amp;auto=1" allowfullscreen="true" quality="hight" src="'+
b.data("url")+'" type="application/x-shockwave-flash" wmode="transparent"></div></div>',a.after(b)}});$(".retract, .topic-image img").live("click",function(){var b=$(this).parent().parent();b.siblings(".topic-preview").show();b.hasClass("media-image")||b.hasClass("media-video")?(b.empty(),b.remove()):b.hide()});$(".topic-preview li[data-type=goods]").live("click",function(){var b=$(this),d=b.parents(".topic-preview");if("1"==b.data("hasbig")){var a=b.data("id");d.hide();d.siblings(".media-goods[data-gid="+
a+"]").show()}else a=b.data("id"),$.ajax({url:GUANGER.path+"/editor/fetchBaobei",type:"post",dataType:"json",data:{id:a},success:function(c){if(100==c.code){var g='<div class="media-box media-goods" data-gid="'+a+'"><div class="media-oper"><a class="retract" href="javascript:;">\u6536\u8d77</a><span class="vline5">|</span><a class="show-big" href="'+GUANGER.path+"/baobei/"+a+'" target="_blank">\u6d4f\u89c8\u5b9d\u8d1d</a></div><div id="J_Baobei'+a+'" class="baobei clearfix">',f=c.baobei.id,j="http://www.letushuo.com/baobei/"+
f,h=c.baobei.name,h=15<$.guang.util.getStrLength(h)?$.guang.util.substring4ChAndEn(h,15)+"\u2026":h,m=c.baobei.pic,k=c.baobei.recommend,k=k?40<k.length?k.substring(0,40)+"\u2026":k:"",i="";if(c.baobei.brandList&&0<c.baobei.brandList.length){for(var i=i+"<p>\u54c1\u724c\uff1a",e=0;e<c.baobei.brandList.length;e++)i+="<span>"+c.baobei.brandList[e].brandName+"</span>";i+="</p>"}var l="";if(c.baobei.tags&&0<c.baobei.tags.length)for(e=0;e<c.baobei.tags.length;e++)l+="<span>"+c.baobei.tags[e].tagKeyword+
"</span>";e=c.baobei.summary.worthCount;d.after(g+('<div class="baobei-pic" rel="big"><a href="javascript:;"><img src="'+m+'" alt="'+h+'" /></a><span>\uffe5'+c.baobei.priceMin/100+'</span></div><div class="baobei-text"><h4><a target="_blank" href="'+j+'">'+h+'</a></h4><div class="baobei-info"><p>'+k+"</p>"+i+"<p>\u6807\u7b7e("+c.baobei.tagCount+")\uff1a"+l+'</p></div><div class="clearfix mt15"><a class="ilike-n" rel="like" data-prourl="'+j+'" data-proimgsrc="'+m+'" data-proname="'+h+'" data-type="0" data-proid="'+
f+'" href="javascript:;">\u559c\u6b22</a><div class="stat-box fr">\u9274\u5b9a('+e+"/"+(e+c.baobei.summary.unworthCount)+')<span class="mr5 ml5">|</span>\u8bc4\u8bba('+c.baobei.commentNum+')</div></div></div><a target="_blank" href="'+j+'" class="baobei-link"></a>')+"</div></div>");d.hide();b.data("hasbig","1")}}})});$(".media-box img").live("click",function(){$(this).parents(".media-box").hide();$(this).parents(".media-box").siblings(".topic-preview").show()});$(".ilike-n").live("click",function(){var b=
$(this);$.guang.dialog.like_say(b,function(){})})});
