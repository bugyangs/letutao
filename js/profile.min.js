$(function() {
	
	var a;
	$(".combox").hover(function(){
        $(this).css("border","1px solid #65c5b3");		
    },function(){
        $(this).css("border","1px solid #EDEDED");		
    });
    $("#pannel li").live("mouseover",function(){
        $(this).removeClass("out");
        $(this).addClass("over");	
    }).live('mouseout',function(){
        $(this).removeClass("over");
        $(this).addClass("out");	
    }).live('click',function(){
        $(".select").val($(this).attr("default"));
        $("#pannel").hide();	
    });
	
	
		 $(".add_goods").hover(function() {
            $(".m_button").addClass("cblock");
			a != null && clearTimeout(a);
        },
        function() {
            a = setTimeout(function() {
                $(".m_button").removeClass("cblock");
            },
            700)
        });
		
		$(".m_button").hover(function() {
            a != null && clearTimeout(a)
        },
        function() {
            a = setTimeout(function() {
                $(".m_button").removeClass("cblock");
            },
            700)
        });
	

		   $(".add_goods").live("click",function(){
				if($.guang.dialog.isLogin()){
				$.guang.dialog.add_good();
				}
	});
	
	$("a[rel=shareGoods]").live("click",function(){
				if($.guang.dialog.isLogin()){
				$.guang.dialog.add_good();
				}
	});
	
	$("a[rel=del_feed]").live("click",function(){
				if($.guang.dialog.isLogin()){
					var curGoodsItem = $(this).closest(".section");
					var feedid = $(this).attr("data-feedid");
					
					if(confirm('您确定要删除此动态吗？')){
				
					$.ajax({
				   url: GUANGER.path+"index.php?app=share&ac=do&le=del_feed",
				   type : "post",
				   dataType: "json",
				   data: {
					   feedid : feedid
				   },
				   success: function(data){
					   var $json = data;
					   switch($json.code){
					   case(100):
						   curGoodsItem.hide(500);
						  break;
					   case(101):
						   alert($json.msg);
					   	break;
					   }  
				   }
			});
					
				}
				}
	});
	
	
		   $(".select").live("click",function(){
				
				resulthtml = GUANGER.resulthtml;
                $("#pannel").html(resulthtml);
                $("#pannel").show();
				
	});
	
	
	
	  $(".add_pic").live("click",function(){
				if($.guang.dialog.isLogin()){
				$.guang.dialog.add_pic();
				}
	});
		   
		   //添加个人标签 set_tag
		$("#set_tag").live("click",function(){
				if($.guang.dialog.isLogin()){
				$.guang.dialog.add_tag();
				}
	});

	$(".add_sub").live("click",function(){
				var $this = $(this);
				if(parseInt(GUANGER.userscore)<parseInt(GUANGER.systemscore)){
				$.guang.tip.conf.tipClass = "tipmodal tipmodal-error";
				$.guang.tip.show($this,">_< 您暂时没有权限创建主题");
				}else{
					if($.guang.dialog.isLogin()){
					$.guang.dialog.add_sub();
					}
				}
	});
	
	
		$(".add_brand").live("click",function(){
				var $this = $(this);
				$.guang.tip.conf.tipClass = "tipmodal tipmodal-error";
				$.guang.tip.show($this,">_< 您暂时没有权限发布品牌");
	});

	//取消喜欢
	var $ilikeDel = $(".ilike-del");
	//$ilikeDel.css("display","none");
	$ilikeDel.live("click",function(){
		if($.guang.dialog.isLogin()){
			var goodsId = $(this).attr("data-proid");
			var curGoodsItem = $(this).closest("li");
			
			var le = $(this).attr("data-le");
			if(le =='del_good'){
				
				if(confirm('您确定要删除此商品吗？')){
				
					$.ajax({
				   url: GUANGER.path+"index.php?app=share&ac=do&le="+le,
				   type : "post",
				   dataType: "json",
				   data: {
					   goodsId : goodsId
				   },
				   success: function(data){
					   var $json = data;
					   switch($json.code){
					   case(100):
						   curGoodsItem.addClass("goods-gray");
						  break;
					   case(101):
						   alert($json.msg);
					   	break;
					   }  
				   }
			});
					
				}
			}else{
					
					$.ajax({
				   url: GUANGER.path+"index.php?app=share&ac=do&le="+le,
				   type : "post",
				   dataType: "json",
				   data: {
					   goodsId : goodsId
				   },
				   success: function(data){
					   var $json = data;
					   switch($json.code){
					   case(100):
						   curGoodsItem.addClass("goods-gray");
						  break;
					   case(101):
						   alert($json.msg);
					   	break;
					   }  
				   }
			});	
					
				}
			
		}
				
	});
		   
	//$(".ilike-m").css("display","none");
	/* 喜欢 */
	
	 $(".main li").bind("mouseover mouseout",
    function(b) {
        var a = $(this);
        "mouseover" == b.type ? ($(".baobei")[0] && a.css({
            border: "1px solid #ddd"
        }), a.find(".ilike-m")[0] ? a.find(".ilike-m").show() : a.find(".ilike-del")[0] && a.find(".ilike-del").show(), a.find(".ilike-topic")[0] && a.find(".ilike-topic").show()) : ($(".baobei")[0] && a.css({
            border: "1px solid #f1f1f1"
        }), a.find(".ilike-m")[0] ? a.find(".ilike-m").hide() : a.find(".ilike-del")[0] && a.find(".ilike-del").hide(), a.find(".ilike-topic")[0] && a.find(".ilike-topic").hide())
    });
	
	$(".ilike-m").live("click",function(){
		if($.guang.dialog.isLogin()){
			var $this = $(this);
			var commentType = $this.attr("data-type");
			var productId = $this.attr("data-proid");
			var $likeCount = $this.closest(".goods").find(".like-count:first");
			if($("#cmtDialog")[0]){
				$("#cmtDialog").fadeOut();
			}
			$.guang.judgement.repeatIdentityClk = function(o, commentType){
				$.guang.tip.conf.tipClass = "tipmodal tipmodal-general";
				$.guang.tip.show($this,">_< 你已经喜欢过了哦~");
			}
			$.guang.judgement.identityCallback = function(o, commentType){
				$likeCount.text(parseInt($likeCount.text()) + 1);
				$.guang.dialog.lkComment($this);
			}
			$.guang.judgement.identityOper($this, productId, commentType);
		}
	});
	
});


 function UploadShareImg()
    {

        $("#loadingImg0").show();
		$.ajaxFileUpload({
            url:GUANGER.path+"index.php?app=share&ac=do&le=UploadImg",
			secureuri :false,
			dataType: 'text',
			fileElementId :'uploadShareImg',
            success:function(result)
            {
				
				if(result){
				$("#loadingImg0").hide()
				$("#thumb0").show();
				$("#thumb0").attr("src",GUANGER.path + result);
				$("#img_url").val(GUANGER.path+result);
			
					
				}else{
					
					 alert("上传失败");
				}
         
                  

				
            },
            error:function ()
            {
                alert("上传失败");
            }
        });
       
    }
