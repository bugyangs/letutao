(function(a){a.guang.productDiscount={productMerchantId:"",productId:"",setData:function(){a.ajax({url:GUANGER.path+"/baobei/getDiscount?"+Math.floor(new Date/10),type:"post",dataType:"json",data:{productMerchantId:a.guang.productDiscount.productMerchantId,productId:a.guang.productDiscount.productId},success:function(b){var c=a("#J_ProductDiscountD");switch(b.code){case 100:c.find(".discount-code").html("\u901b"+b.discountCode);c.find(".shop-url").attr("href",b.shopUrl);break;case 101:c.find(".bd").html('<p class="msg error r3">\u4eb2\uff0c\u7a0b\u5e8f\u9519\u8bef~</p>');
break;case 102:c.find(".bd").html('<p class="msg erro r3">\u4eb2\uff0c\u53c2\u6570\u9519\u8bef~</p>');break;case 110:c.find(".bd").html('<p class="msg error r3">\u4eb2\uff0c\u8be5\u5e97\u94fa\u4f18\u60e0\u5df2\u7ed3\u675f~</p>');break;case 200:c.find(".bd").html('<p class="msg error r3">\u4eb2\uff0c\u60a8\u8fd8\u6ca1\u767b\u9646\u54e6~</p>')}},error:function(){$discountDialog.find(".bd").html('<p class="msg error r3">\u4eb2\uff0c\u670d\u52a1\u5668\u8fde\u4e0d\u4e0a\u4e86\uff0c\u8054\u7cfb\u901b\u901bMM\u54e6~~</p>')}})},
guangVipDialog:function(b){if(!a.guang.dialog.isLogin())return!1;a.guang.productDiscount.productId=b.data("proid");if(a("#J_GuangVipD")[0])a("#J_GuangVipD").data("overlay").load();else{a("body").append('<div id="J_GuangVipD" class="g-dialog discount-dialog"><div class="dialog-content"><div class="hd"><h3>\u6709\u60ca\u559c\uff01</h3></div><div class="bd clearfix"><p class="vip-desc">\u73b0\u5728\u8d2d\u4e70\u8fd9\u4e2a\u5b9d\u8d1d\uff0c\u6709\u901b\u901b\u4f1a\u5458\u7684\u4e13\u4eab\u4f18\u60e0\u54e6\uff01</p><div class="clearfix pt20"><a class="bbl-btn J_GetDiscountBtn">\u9886\u53d6\u4f18\u60e0</a><a class="bgr-btn cancel">\u53d6\u6d88</a></div></div><a class="close" href="javascript:;"></a></div></div>');
var c=a("#J_GuangVipD");c.width("350");c.overlay({top:"center",fixed:!1,mask:{color:"#000",loadSpeed:200,opacity:0.3},closeOnClick:!1,load:!0});c.find(".J_GetDiscountBtn").click(function(){a("#exposeMask").remove();a.guang.productDiscount.init(a(this))});c.find(".cancel").click(function(){c.overlay().close()})}},getDiscountDialog:function(){if(a("#J_ProductDiscountD")[0])a("#J_ProductDiscountD").data("overlay").load();else{var b;b=""+('<div id="J_ProductDiscountD" class="g-dialog discount-dialog"><div class="dialog-content"><div class="hd"><h3>\u6210\u529f\u9886\u53d6\uff0c\u4f18\u60e0\u7801\u5f53\u65e5\u6709\u6548\u3002</h3></div><div class="bd clearfix"><div class="text clearfix"><label>\u4f18\u60e0\u7801:</label><span class="discount-code">\u901b</span><a href="javascript:;" class="copy-code" id="J_Clip">\u590d\u5236</a></div><div class="tac clearfix"><a class="inlineblock shop-url" href="http://www.letushuo.com" target="_blank">\u7acb\u5373\u62a2\u8d2d</a></div><div class="share-row clearfix">'+
a("#J_ShareChk").html()+'</div><div class="howtouse"><span>\u5982\u4f55\u4f7f\u7528\uff1a</span>\u62cd\u4e0b\u5546\u54c1 > \u7528\u65fa\u65fa\u8054\u7cfb\u5ba2\u670d > \u62a5\u4e0a\u4f18\u60e0\u7801\u3002</div></div><a class="close" href="javascript:;"></a></div></div>');a("body").append(b);a("#J_ShareChk").remove();b=a("#J_ProductDiscountD");b.width("350");b.overlay({top:"center",fixed:!1,mask:{color:"#000",loadSpeed:200,opacity:0.3},closeOnClick:!1,load:!0});if(a.browser.msie)a(".copy-code").unbind().bind("click",
function(){var d=a(".discount-code").text();window.clipboardData.setData("Text",d)});else{var c=new ZeroClipboard.Client;c.setHandCursor(!0);c.addEventListener("mouseover",function(){c.setText(a(".discount-code").text())});c.glue("J_Clip",void 0,{zIndex:99999});document.getElementById("J_Clip").onmouseover=function(){c.reposition(this)}}a("#J_BindSina").click(function(){var d=a(this),b=d.data("bind");"on"==b||"off"==b||(d[0].checked=!1,window.open(GUANGER.path+"/account/snsLogin?snsType=sina&backType=2",
"","scrollbars=0,resizable=0,status=1"))});a("#J_BindTencent").click(function(){var b=a(this),c=b.data("bind");"on"==c||"off"==c||(b[0].checked=!1,window.open(GUANGER.path+"/account/snsLogin?snsType=tec_weibo&backType=2","","scrollbars=0,resizable=0,status=1"))});a("#J_BindQzone").click(function(){var b=a(this),c=b.data("bind");"on"==c||"off"==c||(b[0].checked=!1,window.open(GUANGER.path+"/account/snsLogin?snsType=qzone&backType=2","","scrollbars=0,resizable=0,status=1"))});var e=!1;a(".shop-url").click(function(){if(e)return!1;
a(this);var b="",c="\u6211\u521a\u5728 www.letushuo.com \u9886\u4e86\u4f18\u60e0\u7801\uff0c\u4f60\u4eec\u4e5f\u5feb\u53bb\u9886\u5427\uff01\u6bcf\u592910\u70b9\uff0c\u901a\u8fc7\u4f18\u60e0\u7801\u4eab\u53d7\u4e13\u5c5e\u8d85\u4f4e\u4f18\u60e0\u54e6\uff01\u94fe\u63a5\u5728\u8fd9\uff1a"+window.location.href;a("#J_BindSina")[0].checked&&(b=",sina");a("#J_BindTencent")[0].checked&&(b+=",tec_weibo");a("#J_BindQzone")[0].checked&&(b+=",qzone");b=b.substring(1);""!=b&&a.ajax({url:GUANGER.path+"/forum/shareSNS",
type:"post",dataType:"json",data:{sites:b,content:c,url:"http://www.letushuo.com"+window.location.pathname},beforeSend:function(){e=!0},success:function(){e=!1}})})}},init:function(b){if(!a.guang.dialog.isLogin())return!1;b.data("merchantid")&&""!=b.data("merchantid")&&(a.guang.productDiscount.productMerchantId=b.data("merchantid"));b.data("proid")&&""!=b.data("proid")&&(a.guang.productDiscount.productId=b.data("proid"));a.guang.productDiscount.getDiscountDialog();a.guang.productDiscount.setData()}};a(".ilike-m[rel=proDiscount]").click(function(){a.guang.productDiscount.guangVipDialog(a(this))})})(jQuery);
