$(function(){var c={isSubmitReplyEnable:!0,replyType:0,replyNullLen:0,dialogHtml:function(){return'<div id="J_CmtReplyDialog" class="g-dialog reply-dialog" style="width:430px;"><div class="dialog-content"><div class="hd"><h3>\u56de\u590d<a class="J_ReplyTo" href="{{href}}" target="_blank">{{usernick}}</a></h3></div><div class="cmt bd clearfix" data-cmtid="{{commentid}}"><div class="cmt-reply J_CmtReply" style="display:block"><textarea class="b-textarea J_ReplyTxt"></textarea><p class="reply-info clearfix"><a class="sbl-btn J_ReplySubmit" data-type="dialog" data-proid="{{proid}}">\u56de\u590d</a></p></div></div><a class="close" href="javascript:;"></a></div></div>'},
dialog:function(a){c.isSubmitReplyEnable="true";if(!$.guang.dialog.isLogin())return!1;if($("#J_CmtReplyDialog")[0])$("#J_CmtReplyDialog").data("overlay").load();else{$("body").append(c.dialogHtml());var b=$("#J_CmtReplyDialog");b.overlay({top:"center",mask:{color:"#000",loadSpeed:200,opacity:0.3},closeOnClick:!1,load:!0})}b=$("#J_CmtReplyDialog");b.find(".J_ReplyTo:first").attr("href",GUANGER.path+"/u/"+a.data("userid")).html(a.data("usernick"));b.find(".cmt:first").data("cmtid",a.data("commentid"));
b.find(".J_ReplySubmit:first").data("proid",a.data("proid"))},submitReply:function(a){var b=a.closest(".cmt"),d=b.find(".J_ReplyTxt:first");if(""==$.trim(d.val())||""!=$.trim(d.val())&&1==c.replyType&&$.guang.util.getStrLength(d.val())==c.replyNullLen)$.guang.tip.conf.tipClass="tipmodal tipmodal-error",$.guang.tip.show(a,"\u56de\u590d\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff5e");else if(1E3<$.guang.util.getStrLength(d.val()))$.guang.tip.conf.tipClass="tipmodal tipmodal-error",$.guang.tip.show(a,"\u56de\u590d\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc71000~");
else{if("false"==c.isSubmitReplyEnable)return!1;c.isSubmitReplyEnable="false";$.ajax({url:GUANGER.path+"/baobei/addCommentReply",type:"post",dataType:"json",data:{commentId:b.data("cmtid"),replyContent:$.trim(d.val())},beforSend:function(){},success:function(e){if(100==e.code)switch(a.data("type")){case "list":var f='<a class="J_ReplyUserName" href="'+GUANGER.path+"/u/"+GUANGER.userId+'" target="_blank" title="'+GUANGER.nick+'">'+GUANGER.nick+"</a>";"daren"==GUANGER.level&&(f='<a class="J_ReplyUserName g-daren" href="'+
GUANGER.path+"/u/"+GUANGER.userId+'" target="_blank" title="'+GUANGER.nick+'"><em class="ofh">'+GUANGER.nick+'</em><i class="i-daren" title="\u8fbe\u4eba"></i></a>');e='<li class="clearfix" style="bottom:0;"><p><a href="'+GUANGER.path+"/u/"+GUANGER.userId+'" target="_blank" title="'+GUANGER.nick+'"><img src="'+GUANGER.userPhoto+'" width="20px" height="20px" alt="'+GUANGER.nick+'"/></a>'+f+"<span>\uff1a"+e.commentReplyContent+"<em>\u521a\u521a</em></span></p></li>";b.find(".J_ReplyList:first").prepend(e);
e=b.find(".J_ReplyCount:first");f=parseInt(e.data("count"))+1;e.html("("+f+")").data("count",f);d.val("");c.isSubmitReplyEnable="true";c.replyType=0;c.replyNullLen=0;break;case "dialog":$.guang.tipForOper.conf.html='<p class="success-text"><span class="correct">\u56de\u590d\u5df2\u53d1\u9001\u6210\u529f\uff01</span></p><p class="clearfix"><a class="bbl-btn goCheck J_ReplyCheck" href="{{href}}">\u67e5\u770b\u6211\u7684\u56de\u590d</a><a class="bgr-btn closeD ml10" href="javascript:;">\u5173\u95ed</a></p>',
$.guang.tipForOper.init(),$("#J_TipForOper").find(".J_ReplyCheck:first").attr("href",GUANGER.path+"/baobei/"+a.data("proid")+"#cmt="+b.data("cmtid")),d.val(""),setTimeout(function(){$("#J_TipForOper").overlay().close()},5E3)}},error:function(){}})}},init:function(){$(".J_CmtReplyDialogBtn").live("click",function(){c.dialog($(this))});$(".J_CmtReplyBtn").live("click",function(){if(!$.guang.dialog.isLogin())return!1;var a=$(this).closest(".cmt"),b=a.find(".J_CmtReply:first");b[0]?"none"==b.css("display")?
b.css("display","block"):b.css("display","none"):$.ajax({url:GUANGER.path+"/baobei/listCommentReply",type:"post",dataType:"html",data:{commentId:a.data("cmtid")},beforSend:function(){},success:function(b){a.find(".cmt-doc:first").append(b)}})});$(".J_ReplySubmit").live("click",function(){var a=$(this);c.submitReply(a)});$(".J_ReplyTxt").live("keyup",function(a){var b=$(this);$.guang.util.submitByEnter(a,function(){c.submitReply(b.closest(".J_CmtReply").find(".J_ReplySubmit:first"))})});$(".J_ReplyReplyBtn").live("click",
function(){var a=$(this),b=a.closest(".cmt").find("textarea:first"),a="\u56de\u590d @"+a.closest("li").find(".J_ReplyUserName:first").html().replace(/<.+?>/gim,"")+" \uff1a";b.val(a);$.guang.util.moveEnd(b[0]);c.replyType=1;c.replyNullLen=$.guang.util.getStrLength(a)});$(".J_ReplyList li").live("mouseover",function(){$(this).find(".J_ReplyReplyBtn").show()}).live("mouseout",function(){$(this).find(".J_ReplyReplyBtn").hide()});$(".J_ReplyTo").live("mouseover",function(){var a=$(this),b="notimeout";
""==a.data("userid")&&(a.removeAttr("href"),b=setTimeout(function(){$.guang.tip.conf.tipClass="tipmodal tipmodal-error";$.guang.tip.conf.timerLength=2E3;$.guang.tip.show(a,"\u62b1\u6b49\uff0c\u8be5\u6635\u79f0\u76ee\u524d\u4e0d\u5b58\u5728\u54e6\u3002");a.data("timeoutid","notimeout")},500),a.data("timeoutid",b))}).live("mouseout",function(){var a=$(this);"notimeout"!==a.data("timeoutid")&&clearTimeout(parseInt(a.data("timeoutid"),10))})}};c.init()});
