(function(a){a.guang.judgement={identityCallback:function(){},repeatIdentityClk:function(){},awardClk:function(){var b='<div id="awardDialog" class="g-dialog" style="width:400px;z-index: 9999; top: 363.5px; left: 643px; position: fixed; display: block; "><div class="dialog-content"><div class="hd"><h3>\u4f60\u559c\u6b22\uff0c\u901b\u4e70\u5355</h3></div><div class="bd clearfix tac"><span style="color:#E26;font-size:16px;font-weight:bold;line-height:30px;">\u606d\u559c\uff0c\u4f60\u4e2d\u5956\u4e86</span><br/><span style="font-size:14px;line-height:30px;">\u8bf7\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u9886\u53d6\u795e\u79d8\u5956\u54c1</span><br/><a href="'+
GUANGER.path+'/account/award" target="_blank" class="bbl-btn award-tag mt20" style="margin-left:148px;cursor:pointer;">\u67e5\u770b</a></div><a class="close" href="javascript:;"></a></div></div>';a("body").append(b);a("#awardDialog").overlay({top:"center",mask:{color:"#000",loadSpeed:200,opacity:0.3},closeOnClick:!0,load:!0,onClose:function(){a("#awardDialog,#exposeMask").remove()}});a(".award-tag").unbind();a(".award-tag").bind("click",function(){a("#awardDialog,#exposeMask").overlay().close();return!0})},
identityOper:function(b,g,c){var e="0"==c?"index.php?app=share&ac=do&le=like":"index.php?app=share&ac=do&le=identity",i="";b.data("sid")&&(i=b.data("sid"));a.ajax({url:GUANGER.path+e,type:"post",dataType:"json",data:{productId:g,identify:"1"==c?"1":"0",sid:i},success:function(e){switch(e.code){case 100:a.guang.judgement.identityCallback(b,c);break;case 101:a.guang.judgement.identityCallback(b,c);break;case 103:a.guang.judgement.repeatIdentityClk(b,e.desirable);break;case 666:a.guang.judgement.awardClk(b)}}})},cmtSubmitOkClk:function(){},
cmtSubmitErrorClk:function(){},cmtSubmit:function(b,g,c){var e=a.guang.util.trim(c.find("textarea[name='commentContent']").val()),i=c.find("input[name='commentType']").val();referid=c.find("input[name='referid']").val();back_url=c.find("input[name='back_url']").val();g.find(".error-row");$this=c;""!=e&&2<=a.guang.util.getStrLength(e)?1E3>a.guang.util.getStrLength(e)?a.ajax({url:GUANGER.path+"index.php?app=share&ac=do&le=comment",type:"post",dataType:"json",data:{productId:b,commentContent:e,commentType:i,referid:referid},success:function(b){switch(b.code){case 100:a.guang.tip.conf.tipClass="tipmodal tipmodal-ok";a.guang.tip.show($this,
"\u8bc4\u8bba\u53d1\u8868\u6210\u529f\uff01");a.guang.judgement.cmtSubmitOkClk();setTimeout(function(){
							window.location.href=back_url;
						},1000);break;case 101:a.guang.tip.conf.tipClass="tipmodal tipmodal-error",a.guang.tip.show($this,b.msg),a.guang.judgement.cmtSubmitErrorClk()}}}):(a.guang.tip.conf.tipClass="tipmodal tipmodal-general",a.guang.tip.show($this,">_< \u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc71000\u4e2a\u6c49\u5b57\uff01")):(a.guang.tip.conf.tipClass="tipmodal tipmodal-general",a.guang.tip.show($this,">_< \u4f60\u7684\u8bc4\u8bba\u592a\u77ed\u5566\uff0c\u518d\u591a\u8bf4\u51e0\u53e5\u5427\uff01"))},
commentAndAddTagsSubmitOkClk:function(){},commentAndAddTagsSubmitErrorClk:function(){},commentAndAddTagsSubmit:function(b,g){$this=g;a.ajax({url:GUANGER.path+"/baobei/commentMore",type:"post",dataType:"json",data:b,success:function(b){switch(b.code){case 100:a.guang.tip.conf.tipClass="tipmodal tipmodal-ok";a.guang.tip.show($this,"\u8bc4\u8bba\u53d1\u8868\u6210\u529f\uff01");a.guang.judgement.commentAndAddTagsSubmitOkClk(b);break;case 101:a.guang.tip.conf.tipClass="tipmodal tipmodal-error";a.guang.tip.show($this,
b.msg);a.guang.judgement.commentAndAddTagsSubmitErrorClk(b);break;case 444:alert("\u4f60\u5df2\u88ab\u7981\u6b62\u767b\u5f55\uff01");window.location.href="http://www.letushuo.com/logout";break;case 440:alert("\u4f60\u5df2\u88ab\u7981\u8a00\uff01");a.guang.judgement.commentAndAddTagsSubmitErrorClk(b);break;case 441:a.guang.tip.conf.tipClass="tipmodal tipmodal-error",a.guang.tip.show($this,"\u4eb2,\u64cd\u4f5c\u8fc7\u5feb\u4e86\u54e6,\u4f11\u606f\u7247\u523b\uff01")}}})},taolunzuLikeCallback:function(){},
repeattaolunzuLikeClk:function(){},taolunzuLikeSubmit:function(b,g,gid){var c=a.extend({url:"",type:"post",dataType:"json",data:{postid: gid,commentType: 'g'}},g||{});a.ajax({url:c.url,type:c.type,dataType:c.dataType,data:c.data,success:function(e){switch(e.code){case 100:a.guang.judgement.taolunzuLikeCallback(b,e);break;case 101:a.guang.tip.conf.tipClass="tipmodal tipmodal-error";a.guang.tip.show(b,e.msg);break;case 103:a.guang.judgement.repeattaolunzuLikeClk(b,e);break;case 200:a.guang.dialog.login()}}})}};a.guang.cmt={limitMinNum:4,
limitMaxNum:1E3,lkCommentSubmitOkClk:function(){},lkComment:function(b){var g=a("#J_HiddenProductId").val();a("#cmtDialog")[0]?(a("#cmtDialog").find("textarea").val(""),a("#cmtDialog").fadeIn()):(a("body").append('<div id="cmtDialog" class="c-dialog"><p class="title clearfix"><a class="cmtclose fr" href="javascript:;">x</a>\u559c\u6b22\u4e86~</p><div id="cmt-form"><div class="error-row error-like"><p class="error"></p></div><div><textarea class="cmt-txa" name="commentContent" placeholder="\u8bf4\u8bf4\u559c\u6b22\u7684\u7406\u7531\u5427~"></textarea><input type="hidden" name="commentType" value="0"/></div><div class="cmt-act tar"><input type="submit" id="J_LkCommentSubmit" class="pub" value="\u53d1\u5e03"/></div></div>'),
a(".cmt-txa").focus(function(){var b=a("#cmtDialog").offset().top;a("#cmtDialog").css({top:b-50+"px",height:104});a(this).height(50);a(".cmt-txa").unbind("focus")}));var c=a.guang.util.getPosition(b).topMid(),e=a("#cmtDialog").outerWidth(),i=a("#cmtDialog").outerHeight();a("#cmtDialog").css({left:c.x-e/2+"px",top:c.y-i-12+"px"}).fadeIn();var h="true";a("#J_LkCommentSubmit").unbind("click").click(function(e){e.preventDefault();if(h=="false")return false;h="false";a("#J_HiddenProductId")[0]||(g=b.attr("data-proid"));
a.guang.judgement.cmtSubmitOkClk=function(){a("#cmtDialog").fadeOut();a.guang.cmt.lkCommentSubmitOkClk(a.guang.util.trim(a("#cmtDialog").find("textarea[name='commentContent']").val()))};a.guang.judgement.cmtSubmit(g,a("#cmtDialog"),a("#cmt-form"),"like");h="true"});a(".cmtclose").unbind("click").click(function(){a("#cmtDialog").fadeOut()})},commentSubmitOkClk:function(){},comment:function(b){var g=b.attr("data-type"),c=a("#J_HiddenProductId").val();if(a("#commentDialog")[0])a("#commentDialog").data("overlay").load(),
a("#commentDialog").find("textarea").text("");else{a("body").append('<div id="commentDialog" class="g-dialog"><div class="dialog-content"><div class="hd"><h3>\u6dfb\u52a0\u8bc4\u8bba</h3></div><div class="bd clearfix"><div id="comment-form"><div class="error-row error-worth"><p class="error worth-error"></p></div><div class="form-row">'+('<textarea class="b-textarea cmt-txa" name="commentContent" placeholder="\u8bf4\u8bf4\u4f60\u7684\u7406\u7531\u5427~"></textarea><input type="hidden" name="commentType" value="'+
g+'"/></div>')+'<div class="clearfix"><input type="submit" class="bbl-btn pub" id="J_WorthCommentSubmit" value="\u53d1\u5e03"/></div></div></div><a class="close" href="javascript:;"></a></div></div>');a("#commentDialog").overlay({top:"center",mask:{color:"#000",loadSpeed:200,opacity:0.3},closeOnClick:!1,load:!0});var e="true";a("#J_WorthCommentSubmit").click(function(){if("false"==e)return!1;e="false";a("#J_HiddenProductId")[0]||(c=b.attr("data-proid"));a.guang.judgement.cmtSubmitOkClk=function(){a("#commentDialog").overlay().close();
a.guang.cmt.commentSubmitOkClk(a.guang.util.trim(a("#commentDialog").find("textarea[name='commentContent']").val()))};a.guang.judgement.cmtSubmit(c,a("#commentDialog"),a("#comment-form"),"worth");e="true"})}},commentAndAddTagsSubmitOkClk:function(){},commentAndAddTags:function(b,g,c,e,i,h,o,v){b.attr("data-proname")&&0<b.attr("data-proname").length&&(e=b.attr("data-proname"));b.attr("data-proimgsrc")&&0<b.attr("data-proimgsrc").length&&(i=b.attr("data-proimgsrc"));b.attr("data-prourl")&&0<b.attr("data-prourl").length&&
(h=b.attr("data-prourl"));var m=function(c,g,k){var l={},p={identify:"",bought:""},n="\u8bc4\u8bba",m="\u6211\u89c9\u5f97\u8fd9\u4e2a\u5b9d\u8d1d\uff1a",g="1"==g?"":'<input type="checkbox" id="J_Bought" name="bought"/>',q='<a href="javascript:void(0);" class="radioclick worth-radioclick-off mr10" name="worth" data-type="1"><span>\u503c\u5f97</span></a><a href="javascript:void(0);" class="radioclick worth-radioclick-off mr10" name="worth" data-type="0"><span>\u4e0d\u503c\u5f97</span></a>',r="\u8bf4\u8bf4\u4f60\u7684\u7406\u7531\u5427~";
jQuery.trim(c).length&&(m="\u6211\u8ba4\u4e3a\u5b83\uff1a",q="1"==c?'<span class="ml10 mr10 fl worth" style="color:#090">\u503c\u5f97</span>':'<span class="ml10 mr10 fl worth" style="color:#F60">\u4e0d\u503c\u5f97</span>');0==b.data("type")?(n="\u559c\u6b22\u4e86\uff5e",l.like=1,r="\u8bf4\u8bf4\u559c\u6b22\u7684\u7406\u7531\u5457\uff5e"):1==b.data("type")||2==b.data("type")?(n="\u9274\u5b9a",q=1==b.data("type")?'<span class="ml10 mr10 fl worth" style="color:#090">\u503c\u5f97</span>':'<span class="ml10 mr10 fl worth" style="color:#F60">\u4e0d\u503c\u5f97</span>',
l.identify=1==b.data("type")?1:0):3==b.data("type")&&(n="\u8bc4\u8bba",r="");c="";if(k[0])for(var s=0;s<k.length;s++)c+="<li>"+k[s]+"</li>";k='<div id="commentDialog" class="g-dialog" style="z-index: 9999; top: 363.5px; left: 643px; position: fixed; display: block; "><div class="dialog-content"><div class="hd"><h3>'+n+'</h3></div><div class="bd clearfix"><div id="comment-form"><div class="error-row error-worth"><p class="error worth-error"></p></div><div class="commentText-row"><div class="commentText-hd clearfix"><h4 class="fl">'+
m+"</h4>"+q+'<span class="bought fl">'+g+'<label for="J_Bought">\u6211\u4e70\u8fc7</label></span></div><div class="commentText-bd"><textarea class="b-textarea cmt-txa" name="commentContent" id="J_CommentContent" placeholder="'+r+'"></textarea></div></div><div class="commentTags-row"><h4>\u5b9d\u8d1d\u6807\u7b7e<span>\uff08\u591a\u4e2a\u6807\u7b7e\u7528\u7a7a\u683c\u3001\u4e2d\u6587\u6216\u82f1\u6587\u9017\u53f7\u9694\u5f00\uff09</span>\uff1a</h4><input class="b-input" type="input" name="commentTags" id="J_CommentTags"/></div><div class="usedTags-row"><h4>\u5e38\u7528\u6807\u7b7e\uff1a</h4><ul class="clearfix">'+
c+'</ul></div><div class="clearfix pt10"><input type="submit" class="bbl-btn pub" id="J_WorthCommentSubmit" value="\u786e\u5b9a"><!--<div class="share-comment"><span class="gc">\u540c\u6b65\u5206\u4eab\uff1a</span><ul id="J_UserSns"></ul><span><a href="'+GUANGER.path+'/account/sns" target="_blank">\u8bbe\u7f6e</a></span></div>--><div class="taobao-favorite"><input type="checkbox" id="J_Taobaofavorite"/><label for="J_Taobaofavorite">\u6536\u85cf\u5230\u6dd8\u5b9d</label></div></div></div></div><a class="close" href="javascript:;"></a></div></div>';
a("body").append(k);a("#commentDialog").overlay({top:"center",mask:{color:"#000",loadSpeed:200,opacity:0.3},closeOnClick:!1,load:!0,onClose:function(){a("#commentDialog,#exposeMask").remove()}});var t={sina:"ss-sina",tec_weibo:"ss-tencent",qzone:"ss-qzone"},o=a("#J_UserSns");a.ajax({url:GUANGER.path+"/account/getUserSns.html",type:"post",dataType:"json",success:function(b){if(b.code==100){var f="",b=b.userSns,d;for(d in b)t[d]&&(f=f+('<li class="share-switch '+t[d]+"-btnclick-"+b[d]+' btnclick" data-status="'+
b[d]+'" data-snsid="'+d+'" data-webname="'+t[d]+'"></li>'));o.append(f);a(".btnclick").bind("click",function(){var b=a(this),d=b.attr("data-webname")+"-btnclick-on",u=b.attr("data-webname")+"-btnclick-off";b.data("status")=="on"?b.removeClass(d).addClass(u).data("status","off"):b.removeClass(u).addClass(d).data("status","on")})}}});a(".usedTags-row li").click(function(){var b=a("#J_CommentTags").val().replace(/^[\uff0c\,]+/,"").replace(/[\uff0c\,]+$/,""),f=","+b+",",d=a(this);if(d.hasClass("selected")){b=
","+d.text()+",";for(f=f.replace(b,",");f.indexOf(b)>=0;)f=f.replace(b,",");f=f.replace(/^[\uff0c\,]+/,"").replace(/[\uff0c\,]+$/,"");a("#J_CommentTags").val(f);d.removeClass("selected")}else{f=b.length?b+","+d.text():d.text();if(a.guang.util.getStrLength(a.guang.util.htmlToTxt(f))<=64){a("#J_CommentTags").val(f);d.addClass("selected")}else{a.guang.tip.conf.tipClass="tipmodal tipmodal-general";a.guang.tip.show(d,">_< \u6807\u7b7e\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc764\u4e2a\u6c49\u5b57\uff01")}}});
a("#J_CommentTags").keyup(function(){var b=this.value;if(a.guang.util.getStrLength(a.guang.util.htmlToTxt(b))<=64){a(this);for(b=b.replace(/\uff0c|\s+/g,",");b.indexOf(",,")>=0;)b=b.replace(",,",",");for(var f=b.split(","),d=0,e=false;d<f.length;d++){var c=f[d];if(a.guang.util.htmlToTxt(c).length>14){e=true;f[d]=a.guang.util.substring4ChAndEn(c,14)}}e&&(b=f.join(","));if(b!=this.value)this.value=b;a(".usedTags-row li").each(function(){var b=a(this);(","+this.value+",").indexOf(","+b.text()+",")>=
0?b.hasClass("selected")?"selected":b.addClass("selected"):b.hasClass("selected")?b.removeClass("selected"):"noselected"})}else this.value=a.guang.util.substring4ChAndEn(b,64)});a(".radioclick").click(function(){var b=a(this),f=b.attr("name")+"-radioclick-on",d=b.attr("name")+"-radioclick-off";if(b.hasClass(f))b.removeClass(f).addClass(d);else{a("."+f).removeClass(f).addClass(d);b.removeClass(d).addClass(f)}});var j="true";a("#J_WorthCommentSubmit").click(function(){var c=a(this);if(j=="false")return false;
j="false";var f=a("#J_CommentContent").val(),d=a("#J_CommentTags").val();if(f!=""&&a.guang.util.getStrLength(f)>=2){if(a.guang.util.getStrLength(f)>1E3){a.guang.tip.conf.tipClass="tipmodal tipmodal-general";a.guang.tip.show(c,">_< \u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc71000\u4e2a\u6c49\u5b57\uff01");j="true";return false}}else{a.guang.tip.conf.tipClass="tipmodal tipmodal-general";a.guang.tip.show(c,">_< \u4f60\u7684\u8bc4\u8bba\u592a\u77ed\u5566\uff0c\u518d\u591a\u8bf4\u51e0\u53e5\u5427\uff01");
j="true";return false}if(a.guang.util.getStrLength(d)>64){a.guang.tip.conf.tipClass="tipmodal tipmodal-general";a.guang.tip.show(c,">_< \u6807\u7b7e\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc764\u4e2a\u6c49\u5b57\uff01");j="true";return false}if(a("#J_Bought:checked").length>0){l.bought=1;p.bought="1"}if(a(".worth-radioclick-on").length>0){l.identify=parseInt(a(".worth-radioclick-on").eq(0).attr("data-type"),10);p.identify=a(".worth-radioclick-on").eq(0).attr("data-type")}c={productId:b.attr("data-proid"),
sid:b.data("sid")?b.data("sid"):"",commentContent:f,tagNames:a("#J_CommentTags").val(),snsSiteIds:"",productImgUrl:i,commentContent4Sns:""};a.extend(c,l);if(b.attr("data-type")=="0")c.taobaoFavorite=a("#J_Taobaofavorite")[0].checked?1:0;if(a("#J_UserSns li").length>0)for(d=0;d<a("#J_UserSns li").length;d++)if(a("#J_UserSns li").eq(d).data("status")=="on"){var g=a("#J_UserSns li").eq(d).data("snsid");c.snsSiteIds=c.snsSiteIds+(c.snsSiteIds.length>0?","+g:g)}d={"0":"\u559c\u6b22\uff0c",1:"\u8fd9\u5b9d\u8d1d\u503c\uff0c\u63a8\u8350\uff1a",
2:"\u8fd9\u5b9d\u8d1d\u4e0d\u503c\uff1a",3:"\u8bc4\u8bba\u4e86\u300a$\u300b:"};g=135-a.guang.util.getStrLength(d[b.data("type")]+e+h);c.commentContent4Sns=a.guang.util.getStrLength(f)>g?d[b.data("type")].indexOf("$")>=0?d[b.data("type")].replace("$",e)+a.guang.util.substring4ChAndEn(f,g)+"..."+h:d[b.data("type")]+a.guang.util.substring4ChAndEn(f,g)+"..."+e+h:d[b.data("type")].indexOf("$")>=0?d[b.data("type")].replace("$",e)+f+"\u3002"+h:d[b.data("type")]+f+"\u3002"+e+h;a.guang.judgement.commentAndAddTagsSubmitOkClk=
function(b){a("#commentDialog").overlay().close();a.guang.cmt.commentAndAddTagsSubmitOkClk(b,p)};a.guang.judgement.commentAndAddTagsSubmitErrorClk=function(b){b.code==440&&a("#commentDialog").overlay().close();j="true"};a.guang.judgement.commentAndAddTagsSubmit(c,a(this))})};"fromNonDetail"==v?a.ajax({url:GUANGER.path+"index.php?app=share&ac=do&le=comment",type:"post",dataType:"json",data:{productId:b.attr("data-proid")},success:function(b){if(a.guang.dialog.isLogin()&&100==b.code){var c=[];if(b.tagList[0])for(var e=
0;e<b.tagList.length;e++)c[c.length]=b.tagList[e].tagKeyword;m(b.identify,b.bought,c)}}}):m(g,c,o)}}})(jQuery);
function syncTip(){$.guang.tipForOper.conf.html='<p class="unsuccess-text">\u5e10\u53f7\u7ed1\u5b9a\u5931\u8d25\u2026<br />\u8fd9\u4e2a\u5fae\u535a\u5e10\u53f7\u5df2\u7ecf\u548c\u5176\u5b83\u901b\u5e10\u53f7\u7ed1\u5b9a\u3002<br />\u8bf7\u5728\u5e10\u53f7\u7ed1\u5b9a\u9875\u9762\uff0c\u91cd\u8bd5\u7ed1\u5b9a\u8fd9\u4e2a\u5fae\u535a\u5e10\u53f7</p><p class="clearfix"><a class="bbl-btn goBind" href="'+GUANGER.path+'/account/sns" target="_blank">\u73b0\u5728\u5c31\u53bb</a><a class="bgr-btn closeD ml10" href="javascript:;">\u53d6\u6d88</a></p>';
$.guang.tipForOper.init();$(".goBind").click(function(){$("#J_TipForOper").overlay().close()})}function setSync(a,b,g){"sina"==a?100==b?($("#J_BindSina")[0].checked=!0,$("#J_BindSina").data("bind","on")):"1"==g?alert("\u7ed1\u5b9a\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5..."):"2"==g&&syncTip():"tec_weibo"==a&&(100==b?($("#J_BindTencent")[0].checked=!0,$("#J_BindTencent").data("bind","on")):"1"==g?alert("\u7ed1\u5b9a\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5..."):"2"==g&&syncTip())};
